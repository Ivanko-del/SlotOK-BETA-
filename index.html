<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no"/>
  <title>SlotOK v34</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    :root { --bg: #050505; --text: #fff; --box: #141414; --border: #333; --accent: #d4af37; --input: #1a1a1a; --green: #4cd964; --red: #ff3b30; }
    body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 90px; user-select: none; }
    
    .header { padding: 15px; background: var(--bg); border-bottom: 1px solid var(--border); position: sticky; top: 0; z-index: 900; display:flex; justify-content:space-between; align-items:center; }
    .header h1 { margin: 0; font-size: 24px; color: var(--accent); font-weight: 900; font-style: italic; }
    .header-bal { font-size: 16px; background: #222; padding: 5px 15px; border-radius: 20px; border: 1px solid #444; font-weight:bold; color: var(--green); cursor: pointer; }

    .container { padding: 15px; } 
    .hidden { display: none !important; }
    .box { background: var(--box); border-radius: 12px; padding: 15px; border: 1px solid var(--border); margin-bottom: 15px; }
    
    button { padding: 14px; width: 100%; border: none; border-radius: 10px; font-weight: bold; font-size: 15px; cursor: pointer; background: #333; color: #fff; margin-bottom: 8px; transition: 0.2s; }
    button:active { transform: scale(0.98); }
    .btn-gold { background: linear-gradient(45deg, var(--accent), #ffdb4d); color: #000; } 
    .btn-red { background: var(--red); color: #fff; } 
    .btn-green { background: var(--green); color: #000; } 
    .btn-outline { background: transparent; border: 1px solid #555; color: #ccc; }
    .btn-tg { background: linear-gradient(45deg, #229ED9, #1a7fc4); color: #fff; }
    
    input { width: 100%; padding: 14px; margin-bottom: 12px; background: var(--input); border: 1px solid var(--border); color: #fff; border-radius: 10px; font-size: 16px; box-sizing: border-box; text-align: center; font-weight: bold; } 

    /* –ì–û–õ–û–í–ù–ê */
    .hero-banner { width: 100%; height: 150px; background: linear-gradient(135deg, #1e1e1e, #000); border-radius: 12px; margin-bottom: 20px; border: 1px solid var(--accent); display: flex; align-items: center; justify-content: center; flex-direction: column; text-align: center; }
    .hero-title { font-size: 24px; font-weight: 900; color: var(--accent); margin-bottom: 5px; }
    
    .games-scroll { display: flex; gap: 10px; overflow-x: auto; padding-bottom: 10px; scrollbar-width: none; }
    .game-thumb { min-width: 100px; height: 100px; background: var(--box); border: 1px solid var(--border); border-radius: 12px; display: flex; flex-direction: column; align-items: center; justify-content: center; cursor: pointer; gap: 5px; }
    .game-thumb span.icon { font-size: 35px; }
    .game-thumb span.label { font-size: 10px; color: #777; }

    /* –õ–û–ë–Ü */
    .game-card { background: var(--box); border: 1px solid var(--border); border-radius: 12px; padding: 20px; margin-bottom: 10px; display:flex; align-items:center; gap:15px; cursor: pointer; }
    .game-icon { font-size: 35px; } .game-title { font-size: 16px; font-weight: bold; } .game-desc { font-size: 12px; color: #777; }

    /* –Ü–ì–†–ò */
    .reels-container { background: #000; border: 1px solid var(--accent); border-radius: 10px; padding: 15px; display: flex; justify-content: center; gap: 5px; margin-bottom: 15px; } 
    .reel { font-size: 45px; width: 70px; height: 90px; line-height: 90px; background: #fff; color: #000; border-radius: 5px; text-align: center; }
    
    .roulette-wheel { width: 220px; height: 220px; border-radius: 50%; border: 6px solid #222; margin: 0 auto 15px; background: conic-gradient(#4cd964 0deg 18deg, #222 18deg 189deg, #b71c1c 189deg 360deg); transition: 4s ease-out; transform: rotate(0deg); }
    .bet-grid { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; margin-bottom: 15px; } 
    .bet-btn { padding: 10px; border-radius: 6px; background: #222; color: #888; font-size: 11px; text-align: center; border: 1px solid #333; cursor: pointer; } 
    .bet-btn.selected { border-color: var(--accent); color: #fff; background: #333; }
    
    .chests-grid { display: grid; gap: 8px; margin-bottom: 15px; grid-template-columns: repeat(3, 1fr); } 
    .chest-item { background: #222; border-radius: 8px; height: 70px; display: flex; align-items: center; justify-content: center; font-size: 35px; border:1px solid #333; cursor:pointer;} 
    
    .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 15px; }
    .mine-cell { aspect-ratio: 1; background: #222; border-radius: 4px; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 1px solid #333; cursor:pointer;}
    .mine-cell.revealed { background: #111; border-color: #000; }
    
    .plinko-board { position: relative; width: 100%; height: 250px; background: #111; border-radius: 10px; margin-bottom: 10px; border: 1px solid #333; overflow: hidden; } 
    .plinko-ball { position: absolute; width: 12px; height: 12px; background: var(--accent); border-radius: 50%; display: none; }
    .plinko-buckets { display: flex; justify-content: space-between; } .bucket { font-size: 10px; background: #222; width: 14%; text-align: center; border-top: 2px solid #444; padding: 3px 0; }

    .crash-screen { background: #111; height: 200px; border-radius: 12px; border: 1px solid #333; position: relative; display: flex; align-items: center; justify-content: center; margin-bottom: 15px; overflow: hidden; }
    .crash-rocket { font-size: 40px; position: absolute; bottom: 20px; left: 20px; transition: 0.1s linear; } 
    .crash-multiplier { font-size: 40px; font-weight: bold; color: #fff; z-index: 10; }
    .crash-graph { position: absolute; bottom: 0; left: 0; width: 100%; height: 100%; opacity: 0.3; }

    /* –ü–û–ö–ï–† */
    .poker-table { background: radial-gradient(ellipse at center, #1a5c2a 0%, #0d3318 100%); border-radius: 12px; border: 3px solid #8B6914; padding: 15px; margin-bottom: 15px; min-height: 200px; }
    .poker-cards { display: flex; justify-content: center; gap: 8px; flex-wrap: wrap; margin: 10px 0; }
    .card { width: 50px; height: 75px; background: #fff; border-radius: 6px; display: flex; align-items: center; justify-content: center; font-size: 22px; font-weight: bold; border: 1px solid #ddd; color: #000; flex-direction: column; line-height: 1.1; box-shadow: 0 2px 6px rgba(0,0,0,0.5); cursor: pointer; transition: transform 0.2s; }
    .card.red-card { color: #cc0000; }
    .card.selected { transform: translateY(-8px); border-color: var(--accent); box-shadow: 0 4px 12px rgba(212,175,55,0.5); }
    .card.face-down { background: linear-gradient(135deg, #1a3a6b 0%, #0d1f3d 100%); color: transparent; }
    .card.face-down::after { content: "üÇ†"; font-size: 30px; color: rgba(255,255,255,0.3); }
    .poker-info { text-align: center; padding: 8px; background: rgba(0,0,0,0.4); border-radius: 8px; margin: 8px 0; color: #fff; font-size: 14px; }
    .poker-actions { display: grid; grid-template-columns: 1fr 1fr; gap: 8px; }

    /* –ê–î–ú–Ü–ù–ö–ê & –¢–û–ü */
    .admin-user-card { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: #1a1a1a; margin-bottom: 8px; border-radius: 8px; border: 1px solid #333; color: #fff; cursor: pointer;}
    .rank { color: var(--accent); font-weight: bold; width: 30px; text-align:center; }
    table { width: 100%; border-collapse: collapse; } td { padding: 12px 5px; border-bottom: 1px solid #333; font-size: 14px; } 

    /* NAV & MODALS */
    .bottom-nav { position: fixed; bottom: 0; width: 100%; height: 70px; background: #080808; border-top: 1px solid #222; display: flex; justify-content: space-around; align-items: center; z-index: 1000; padding-bottom: env(safe-area-inset-bottom); } 
    .nav-item { display: flex; flex-direction: column; align-items: center; justify-content: center; color: #555; font-size: 10px; width: 14%; height: 100%; cursor: pointer;} 
    .nav-item span.icon { font-size: 22px; margin-bottom: 4px; } .nav-item.active { color: var(--accent); }
    
    #loading-overlay { position: fixed; top:0; left:0; width:100%; height:100%; background: #000; z-index:9999; display:flex; justify-content:center; align-items:center; color:var(--accent); font-size:24px; flex-direction: column; transition: opacity 0.5s; }
    #auth-screen, .full-modal { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: #000; z-index: 5000; padding: 20px; box-sizing: border-box; overflow-y: auto; }
    #toast-container { position: fixed; top: 20px; left: 50%; transform: translateX(-50%); z-index: 6000; width: 90%; max-width: 400px; pointer-events: none; } 
    .toast { background: #222; color: #fff; padding: 12px; margin-bottom: 10px; border-radius: 8px; display: flex; align-items: center; border-left: 4px solid var(--accent); box-shadow: 0 5px 20px rgba(0,0,0,0.5); font-size: 14px; animation: slideIn 0.3s ease; }
    .toast.success { border-left-color: var(--green); }
    .toast.error { border-left-color: var(--red); }
    @keyframes slideIn { from { opacity:0; transform: translateY(-10px); } to { opacity:1; transform: translateY(0); } }
    
    .contact-row { display: flex; justify-content: space-between; align-items: center; padding: 10px; background: #1a1a1a; border-radius: 8px; margin-bottom: 8px; border: 1px solid #333; }
    .profile-header { display: flex; align-items: center; gap: 15px; margin-bottom: 15px; } 
    .avatar-large { width: 70px; height: 70px; background: #222; border-radius: 50%; border: 2px solid var(--accent); display: flex; align-items: center; justify-content: center; font-size: 30px; overflow: hidden; } 
    .avatar-large img { width: 100%; height: 100%; object-fit: cover; }
    .payment-methods { display: grid; grid-template-columns: 1fr 1fr 1fr 1fr; gap: 5px; margin-bottom: 15px; } 
    .pay-btn { background: var(--input); border: 1px solid var(--border); padding: 10px 2px; border-radius: 8px; text-align: center; font-size: 10px; color: #aaa; cursor: pointer; } 
    .pay-btn.selected { border-color: var(--accent); color: var(--accent); background: rgba(212, 175, 55, 0.1); }
    
    /* TELEGRAM –î–ï–ü–û–ó–ò–¢ */
    .tg-deposit-box { background: linear-gradient(135deg, #1a2a3a, #0d1a27); border: 1px solid #229ED9; border-radius: 12px; padding: 20px; margin-bottom: 15px; text-align: center; }
    .tg-logo { font-size: 50px; margin-bottom: 10px; }
    .tg-title { color: #229ED9; font-size: 18px; font-weight: bold; margin-bottom: 5px; }
    .tg-desc { color: #aaa; font-size: 12px; margin-bottom: 15px; line-height: 1.5; }
    .tg-steps { text-align: left; background: rgba(0,0,0,0.3); border-radius: 8px; padding: 12px; margin-bottom: 15px; }
    .tg-step { display: flex; gap: 10px; margin-bottom: 8px; font-size: 13px; color: #ccc; }
    .tg-step-num { color: #229ED9; font-weight: bold; min-width: 20px; }
    .amount-grid { display: grid; grid-template-columns: repeat(4, 1fr); gap: 8px; margin-bottom: 15px; }
    .amount-btn { background: #222; border: 1px solid #333; border-radius: 8px; padding: 10px 5px; text-align: center; font-size: 13px; color: #ccc; cursor: pointer; font-weight: bold; }
    .amount-btn.selected { border-color: #229ED9; color: #229ED9; background: rgba(34, 158, 217, 0.1); }
    
    /* –í–ò–í–Ü–î */
    .withdraw-box { background: linear-gradient(135deg, #1a2a1a, #0d1a0d); border: 1px solid var(--green); border-radius: 12px; padding: 20px; margin-bottom: 15px; }
    .withdraw-title { color: var(--green); font-size: 16px; font-weight: bold; margin-bottom: 10px; }
    .withdraw-method { display: flex; gap: 8px; margin-bottom: 12px; flex-wrap: wrap; }
    .wm-btn { background: #222; border: 1px solid #333; border-radius: 8px; padding: 8px 12px; font-size: 12px; color: #aaa; cursor: pointer; }
    .wm-btn.selected { border-color: var(--green); color: var(--green); }
    .pending-withdraw { background: #1a1a1a; border: 1px solid #333; border-radius: 8px; padding: 12px; margin-bottom: 8px; display: flex; justify-content: space-between; align-items: center; }
    .pw-status { font-size: 11px; padding: 3px 8px; border-radius: 10px; }
    .pw-pending { background: rgba(212,175,55,0.2); color: var(--accent); }
    .pw-done { background: rgba(76,217,100,0.2); color: var(--green); }

    /* –©–û–î–ï–ù–ù–ò–ô –ë–û–ù–£–° */
    .daily-bonus-modal-content { padding: 20px; text-align: center; }
    .bonus-icon { font-size: 60px; animation: bounce 0.5s ease infinite alternate; }
    @keyframes bounce { from { transform: scale(1); } to { transform: scale(1.1); } }
    .bonus-amount { font-size: 36px; font-weight: 900; color: var(--accent); margin: 10px 0; }
    .streak-dots { display: flex; justify-content: center; gap: 8px; margin: 15px 0; }
    .streak-dot { width: 30px; height: 30px; border-radius: 50%; border: 2px solid #333; display: flex; align-items: center; justify-content: center; font-size: 12px; }
    .streak-dot.done { background: var(--accent); border-color: var(--accent); color: #000; }
    .streak-dot.today { background: var(--green); border-color: var(--green); color: #000; animation: pulse 1s ease infinite; }
    @keyframes pulse { 0%,100% { box-shadow: 0 0 0 0 rgba(76,217,100,0.4); } 50% { box-shadow: 0 0 0 8px rgba(76,217,100,0); } }

    /* –°–¢–ê–¢–£–° –ó–ê–Ø–í–ö–ò */
    .request-card { background: #1a1a1a; border-radius: 8px; border: 1px solid #333; padding: 12px; margin-bottom: 8px; }
    .section-header { color: #777; font-size: 12px; margin: 15px 0 8px; text-transform: uppercase; letter-spacing: 1px; border-left: 3px solid var(--accent); padding-left: 8px; }
  </style>
</head>
<body data-theme="dark">

  <div id="loading-overlay">
    <div style="font-size:50px; margin-bottom:20px;">üé∞</div>
    <div>SlotOK v34</div>
    <div style="font-size:12px; color:#555; margin-top:10px;">–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...</div>
  </div>
  
  <div id="toast-container"></div>
  
  <div class="header">
    <h1>SLOT<span>OK</span></h1>
    <div class="header-bal" onclick="switchTab('cashier')"><span class="bal">0</span> ‚Ç¥</div>
  </div>

  <div class="container">
    
    <!-- –ì–û–õ–û–í–ù–ê -->
    <div id="tab-home" class="screen">
        <div class="hero-banner">
            <div class="hero-title">üéÅ BONUS 250%</div>
            <div style="color:#aaa; font-size:13px;">–í—ñ—Ç–∞–ª—å–Ω–∏–π –±–æ–Ω—É—Å –Ω–∞ –ø–µ—Ä—à–∏–π –¥–µ–ø–æ–∑–∏—Ç</div>
        </div>
        
        <!-- –©–æ–¥–µ–Ω–Ω–∏–π –±–æ–Ω—É—Å –±–∞–Ω–µ—Ä -->
        <div id="dailyBonusBanner" class="hidden" style="background: linear-gradient(135deg, #1a2a1a, #0d3a1a); border: 1px solid var(--green); border-radius: 12px; padding: 15px; margin-bottom: 15px; display: flex; align-items: center; justify-content: space-between; cursor: pointer;" onclick="openDailyBonus()">
            <div>
                <div style="font-size:16px; font-weight:bold; color:var(--green);">üéÅ –©–æ–¥–µ–Ω–Ω–∏–π –±–æ–Ω—É—Å!</div>
                <div style="font-size:12px; color:#aaa;">–ó–∞–±–µ—Ä–∏ —Å–≤–æ—é –Ω–∞–≥–æ—Ä–æ–¥—É</div>
            </div>
            <div style="font-size:30px;">‚ú®</div>
        </div>
        
        <div class="section-header">üî• –ü–æ–ø—É–ª—è—Ä–Ω—ñ</div>
        <div class="games-scroll">
            <div class="game-thumb" onclick="openGame('slots')"><span class="icon">üé∞</span><span class="label">–°–ª–æ—Ç–∏</span></div>
            <div class="game-thumb" onclick="openGame('roulette')"><span class="icon">üé°</span><span class="label">–†—É–ª–µ—Ç–∫–∞</span></div>
            <div class="game-thumb" onclick="openGame('crash')"><span class="icon">üöÄ</span><span class="label">–ö—Ä–∞—à</span></div>
            <div class="game-thumb" onclick="openGame('poker')"><span class="icon">üÉè</span><span class="label">–ü–æ–∫–µ—Ä</span></div>
            <div class="game-thumb" onclick="openGame('mines')"><span class="icon">üí£</span><span class="label">–ú—ñ–Ω–∏</span></div>
        </div>
        <button class="btn-outline" style="margin-top:15px;" onclick="switchTab('lobby')">–í—Å—ñ —ñ–≥—Ä–∏ ‚û°</button>
    </div>

    <!-- –õ–û–ë–Ü -->
    <div id="tab-lobby" class="screen hidden">
      <div class="game-card" onclick="openGame('slots')"><span class="game-icon">üé∞</span><div class="game-info"><div class="game-title">Classic 777</div><div class="game-desc">–°–ª–æ—Ç–∏ ‚Ä¢ RTP 95%</div></div></div>
      <div class="game-card" onclick="openGame('roulette')"><span class="game-icon">üé°</span><div class="game-info"><div class="game-title">Royal Roulette</div><div class="game-desc">–†—É–ª–µ—Ç–∫–∞ ‚Ä¢ x2 / x14</div></div></div>
      <div class="game-card" onclick="openGame('crash')"><span class="game-icon">üöÄ</span><div class="game-info"><div class="game-title">Crash Aviator</div><div class="game-desc">–ö—Ä–∞—à ‚Ä¢ –¥–æ x‚àû</div></div></div>
      <div class="game-card" onclick="openGame('poker')"><span class="game-icon">üÉè</span><div class="game-info"><div class="game-title">Video Poker</div><div class="game-desc">5-–∫–∞—Ä—Ç–∫–æ–≤–∞ —Ä–æ–∑–¥–∞—á–∞ ‚Ä¢ NEW</div></div><span style="background:var(--green);color:#000;font-size:10px;font-weight:bold;padding:3px 8px;border-radius:10px;margin-left:auto;">NEW</span></div>
      <div class="game-card" onclick="openGame('chests')"><span class="game-icon">üì¶</span><div class="game-info"><div class="game-title">Magic Chests</div><div class="game-desc">–°—É–Ω–¥—É–∫–∏</div></div></div>
      <div class="game-card" onclick="openGame('mines')"><span class="game-icon">üí£</span><div class="game-info"><div class="game-title">Mines</div><div class="game-desc">–°–∞–ø–µ—Ä</div></div></div>
      <div class="game-card" onclick="openGame('plinko')"><span class="game-icon">üîª</span><div class="game-info"><div class="game-title">Plinko</div><div class="game-desc">–ü–ª—ñ–Ω–∫–æ</div></div></div>
    </div>

    <!-- –Ü–ì–†–ò -->
    <div id="tab-slots" class="screen hidden">
      <button class="btn-outline" onclick="switchTab('lobby')">‚¨Ö –õ–æ–±—ñ</button>
      <div class="reels-container"><div class="reel" id="r1">7</div><div class="reel" id="r2">7</div><div class="reel" id="r3">7</div></div>
      <div class="box">
        <input id="betAmountSlots" type="number" value="100">
        <button class="btn-gold" onclick="spinSlots()">–ö–†–£–¢–ò–¢–ò üé∞</button>
      </div>
    </div>
    
    <div id="tab-roulette" class="screen hidden">
      <button class="btn-outline" onclick="switchTab('lobby')">‚¨Ö –õ–æ–±—ñ</button>
      <div class="roulette-wheel" id="wheel"></div>
      <div class="box">
        <div class="bet-grid">
          <div class="bet-btn" data-color="red" onclick="selectRouletteBet('red', this)">üî¥ RED (x2)</div>
          <div class="bet-btn" data-color="green" onclick="selectRouletteBet('green', this)">üü¢ ZERO (x14)</div>
          <div class="bet-btn" data-color="black" onclick="selectRouletteBet('black', this)">‚ö´ BLACK (x2)</div>
        </div>
        <input id="betAmountRoulette" type="number" value="100">
        <button class="btn-gold" onclick="spinRoulette()">–°–¢–ê–†–¢ üé°</button>
      </div>
    </div>
    
    <div id="tab-crash" class="screen hidden">
      <button class="btn-outline" onclick="switchTab('lobby')">‚¨Ö –õ–æ–±—ñ</button>
      <div class="crash-screen">
        <canvas class="crash-graph" id="crashCanvas"></canvas>
        <div class="crash-rocket" id="crashRocket">üöÄ</div>
        <div class="crash-multiplier" id="crashDisplay">1.00x</div>
      </div>
      <div class="box">
        <input id="betAmountCrash" type="number" value="100">
        <button class="btn-gold" id="crashBtn" onclick="startCrash()">–°–¢–ê–†–¢ üöÄ</button>
        <button class="btn-green hidden" id="crashCashoutBtn" onclick="cashoutCrash()">üí∞ –ó–ê–ë–†–ê–¢–ò</button>
      </div>
    </div>

    <!-- –ü–û–ö–ï–† -->
    <div id="tab-poker" class="screen hidden">
      <button class="btn-outline" onclick="switchTab('lobby')">‚¨Ö –õ–æ–±—ñ</button>
      <div class="poker-table">
        <div style="text-align:center; color:#aaa; font-size:12px; margin-bottom:10px;">üÉè VIDEO POKER ‚Äî –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ä—Ç–∏ –¥–ª—è –∑–∞–º—ñ–Ω–∏</div>
        <div class="poker-cards" id="pokerCards"></div>
        <div class="poker-info" id="pokerInfo">–ó—Ä–æ–±—ñ—Ç—å —Å—Ç–∞–≤–∫—É —ñ –Ω–∞—Ç–∏—Å–Ω—ñ—Ç—å –ì–†–ê–¢–ò</div>
      </div>
      <div class="box">
        <input id="betAmountPoker" type="number" value="100">
        <div class="poker-actions">
          <button class="btn-gold" id="pokerDealBtn" onclick="dealPoker()">üÉè –†–û–ó–î–ê–¢–ò</button>
          <button class="btn-green hidden" id="pokerDrawBtn" onclick="drawPoker()">üîÑ –ó–ê–ú–Ü–ù–ò–¢–ò</button>
        </div>
        <div id="pokerPaytable" style="margin-top:10px; background:#111; border-radius:8px; padding:10px; font-size:12px; color:#777; display:none;">
          <div style="color:var(--accent); margin-bottom:5px; font-weight:bold;">–¢–ê–ë–õ–ò–¶–Ø –í–ò–ü–õ–ê–¢:</div>
          <div style="display:grid; grid-template-columns:1fr 1fr; gap:3px;">
            <span>–†–æ—è–ª-—Ñ–ª–µ—à</span><span style="color:var(--accent);">x800</span>
            <span>–°—Ç—Ä–µ–π—Ç-—Ñ–ª–µ—à</span><span style="color:var(--accent);">x50</span>
            <span>–ö–∞—Ä–µ</span><span style="color:var(--accent);">x25</span>
            <span>–§—É–ª-—Ö–∞—É—Å</span><span style="color:var(--accent);">x9</span>
            <span>–§–ª–µ—à</span><span style="color:var(--accent);">x6</span>
            <span>–°—Ç—Ä–µ–π—Ç</span><span style="color:var(--accent);">x4</span>
            <span>–¢—Ä–∏ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö</span><span style="color:var(--accent);">x3</span>
            <span>–î–≤—ñ –ø–∞—Ä–∏</span><span style="color:var(--accent);">x2</span>
            <span>–ü–∞—Ä–∞ JJ+</span><span style="color:var(--accent);">x1</span>
          </div>
        </div>
        <button class="btn-outline" style="margin-top:5px; font-size:12px; padding:8px;" onclick="togglePaytable()">‚ÑπÔ∏è –¢–∞–±–ª–∏—Ü—è –≤–∏–ø–ª–∞—Ç</button>
      </div>
    </div>
    
    <div id="tab-chests" class="screen hidden">
      <button class="btn-outline" onclick="switchTab('lobby')">‚¨Ö –õ–æ–±—ñ</button>
      <div class="box"><div class="chests-grid" id="chestsGrid"></div></div>
      <div class="box"><input id="betAmountChests" type="number" value="100"><button class="btn-gold" id="chestsPlayBtn" onclick="startChests()">–ì–†–ê–¢–ò üì¶</button></div>
    </div>
    
    <div id="tab-mines" class="screen hidden">
      <button class="btn-outline" onclick="switchTab('lobby')">‚¨Ö –õ–æ–±—ñ</button>
      <div class="box"><div class="mines-grid" id="minesGrid"></div></div>
      <div class="box">
        <input id="betAmountMines" type="number" value="100">
        <button class="btn-gold" id="minesBtn" onclick="startMines()">–°–¢–ê–†–¢ üí£</button>
        <button class="btn-green hidden" id="minesCashoutBtn" onclick="cashoutMines()">–ó–ê–ë–†–ê–¢–ò</button>
      </div>
    </div>
    
    <div id="tab-plinko" class="screen hidden">
      <button class="btn-outline" onclick="switchTab('lobby')">‚¨Ö –õ–æ–±—ñ</button>
      <div class="box">
        <div class="plinko-board" id="plinkoBoard"><div class="plinko-ball" id="plinkoBall"></div></div>
        <div class="plinko-buckets">
          <div class="bucket">x5</div><div class="bucket">x2</div><div class="bucket">x0.5</div>
          <div class="bucket">x0.2</div><div class="bucket">x0.5</div><div class="bucket">x2</div><div class="bucket">x5</div>
        </div>
      </div>
      <div class="box"><input id="betAmountPlinko" type="number" value="100"><button class="btn-gold" onclick="dropPlinko()">–ö–ò–ù–£–¢–ò üîª</button></div>
    </div>

    <!-- –ö–ê–°–ê (–æ–Ω–æ–≤–ª–µ–Ω–∞) -->
    <div id="tab-cashier" class="screen hidden">
      
      <!-- TELEGRAM –î–ï–ü–û–ó–ò–¢ -->
      <div class="tg-deposit-box">
        <div class="tg-logo">‚úàÔ∏è</div>
        <div class="tg-title">–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è —á–µ—Ä–µ–∑ Telegram</div>
        <div class="tg-desc">–ë–µ–∑–ø–µ—á–Ω–æ —ñ —à–≤–∏–¥–∫–æ —á–µ—Ä–µ–∑ –Ω–∞—à–æ–≥–æ –±–æ—Ç–∞.<br>–ü–æ–ø–æ–≤–Ω–µ–Ω–Ω—è –∑–∞—Ä–∞—Ö–æ–≤—É—î—Ç—å—Å—è –ø—Ä–æ—Ç—è–≥–æ–º 1-5 —Ö–≤–∏–ª–∏–Ω.</div>
        <div class="tg-steps">
          <div class="tg-step"><span class="tg-step-num">1.</span><span>–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å –∫–Ω–æ–ø–∫—É ‚Äî –≤—ñ–¥–∫—Ä–∏—î—Ç—å—Å—è –±–æ—Ç</span></div>
          <div class="tg-step"><span class="tg-step-num">2.</span><span>–ù–∞–¥—ñ—à–ª—ñ—Ç—å –±–æ—Ç—É —Å–≤—ñ–π ID —Ç–∞ —Å—É–º—É</span></div>
          <div class="tg-step"><span class="tg-step-num">3.</span><span>–°–ø–ª–∞—Ç—ñ—Ç—å —á–µ—Ä–µ–∑ Privat24 / Mono / –ö–∞—Ä—Ç—É</span></div>
          <div class="tg-step"><span class="tg-step-num">4.</span><span>–ö–æ—à—Ç–∏ –∑–∞—Ä–∞—Ö–æ–≤—É—é—Ç—å—Å—è –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ</span></div>
        </div>
        <div style="background: rgba(0,0,0,0.3); border-radius:8px; padding:10px; margin-bottom:12px; font-size:13px; color:#aaa;">
          –í–∞—à ID: <span id="cashierUserId" style="color:#229ED9; font-weight:bold; font-size:16px;">‚Äî</span>
        </div>
        <div class="amount-grid">
          <div class="amount-btn" onclick="selectDepAmount(100, this)">100‚Ç¥</div>
          <div class="amount-btn" onclick="selectDepAmount(250, this)">250‚Ç¥</div>
          <div class="amount-btn" onclick="selectDepAmount(500, this)">500‚Ç¥</div>
          <div class="amount-btn" onclick="selectDepAmount(1000, this)">1000‚Ç¥</div>
          <div class="amount-btn" onclick="selectDepAmount(2000, this)">2000‚Ç¥</div>
          <div class="amount-btn" onclick="selectDepAmount(5000, this)">5000‚Ç¥</div>
          <div class="amount-btn" onclick="selectDepAmount(10000, this)">10k‚Ç¥</div>
          <div class="amount-btn" id="customAmtBtn" onclick="selectCustomAmount()">–Ü–Ω—à–∞</div>
        </div>
        <div id="customAmountBox" class="hidden">
          <input id="customDepAmount" type="number" placeholder="–í–≤–µ–¥—ñ—Ç—å —Å—É–º—É" style="margin-bottom:8px;">
        </div>
        <button class="btn-tg" onclick="openTelegramBot()">‚úàÔ∏è –í—ñ–¥–∫—Ä–∏—Ç–∏ Telegram –ë–æ—Ç–∞</button>
      </div>

      <!-- –í–ò–í–Ü–î –ö–û–®–¢–Ü–í -->
      <div class="withdraw-box">
        <div class="withdraw-title">üí∏ –í–∏–≤—ñ–¥ –∫–æ—à—Ç—ñ–≤</div>
        <div class="withdraw-method">
          <div class="wm-btn selected" id="wm-privat" onclick="selectWithdrawMethod('privat', this)">üü¢ PrivatBank</div>
          <div class="wm-btn" id="wm-mono" onclick="selectWithdrawMethod('mono', this)">üêà Monobank</div>
          <div class="wm-btn" id="wm-usdt" onclick="selectWithdrawMethod('usdt', this)">‚ÇÆ USDT</div>
        </div>
        <input id="withdrawCard" placeholder="–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏ / USDT –∞–¥—Ä–µ—Å–∞">
        <input id="withdrawAmount" type="number" placeholder="–°—É–º–∞ –≤–∏–≤–æ–¥—É (–º—ñ–Ω. 200‚Ç¥)">
        <button class="btn-green" onclick="submitWithdraw()">üí∏ –ü–û–î–ê–¢–ò –ó–ê–Ø–í–ö–£</button>
      </div>

      <!-- –ú–æ—ó –∑–∞—è–≤–∫–∏ –Ω–∞ –≤–∏–≤—ñ–¥ -->
      <div id="myWithdrawsBox">
        <div class="section-header">–ú–æ—ó –∑–∞—è–≤–∫–∏ –Ω–∞ –≤–∏–≤—ñ–¥</div>
        <div id="myWithdrawsList" style="color:#777; font-size:13px; padding:10px 0;">–ù–µ–º–∞—î –∑–∞—è–≤–æ–∫</div>
      </div>

      <div style="display:flex; gap:8px;">
        <button class="btn-outline" style="border-color:var(--accent); color:var(--accent);" onclick="openModal('transfer-modal')">üí∏ –ü–µ—Ä–µ–∫–∞–∑</button>
        <button class="btn-outline" onclick="openModal('promo-modal')">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</button>
      </div>
    </div>

    <!-- –¢–û–ü -->
    <div id="tab-top" class="screen hidden">
        <div class="box"><h3 style="text-align:center; color:#777; margin:0 0 15px;">üèÜ –†–ï–ô–¢–ò–ù–ì –ì–†–ê–í–¶–Ü–í</h3><table id="topTable"></table></div>
    </div>
    
    <!-- –ü–†–û–§–Ü–õ–¨ -->
    <div id="tab-profile" class="screen hidden">
      <div class="box">
        <div class="profile-header">
            <div class="avatar-large" id="currentAvatar">üë§</div>
            <div>
                <div style="font-size:24px; font-weight:bold;"><span id="profileName">...</span> <span id="adminBadge" class="hidden" style="color:red; font-size:12px;">[ADMIN]</span></div>
                <div style="font-size:12px; color:#777; margin-top:5px;" id="profileTag">...</div>
            </div>
        </div>
        <input id="bioInput" placeholder="–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å..." onchange="updateBio(this.value)">
        <div style="margin-top:10px; color:#777;">ID: <span id="profileId">...</span></div>
        <div style="margin-top:5px; color:#777;">Email: <span id="profileEmail">...</span></div>
        <div style="display:flex; gap:10px; margin-top:15px;">
            <button class="btn-outline" onclick="document.getElementById('avatarInput').click()">üì∑ –§–æ—Ç–æ</button>
            <button class="btn-outline" onclick="openHistoryModal()">üìú –Ü—Å—Ç–æ—Ä—ñ—è</button>
            <button class="btn-outline" onclick="openDailyBonus()">üéÅ –ë–æ–Ω—É—Å</button>
        </div>
        <input type="file" id="avatarInput" accept="image/*" style="display:none;" onchange="handleAvatarUpload(this)">
      </div>
      <div class="box hidden" id="adminPanelBtnBox" style="border-color: #ff3b30; text-align:center;">
          <button class="btn-red" onclick="switchTab('admin')">‚öôÔ∏è –ü–ê–ù–ï–õ–¨ –ê–î–ú–Ü–ù–Ü–°–¢–†–ê–¢–û–†–ê</button>
      </div>
    </div>

    <!-- –ó–ù–ê–ô–û–ú–Ü -->
    <div id="tab-contacts" class="screen hidden">
        <h2 style="color:var(--accent); margin-bottom:15px;">–ó–Ω–∞–π–æ–º—ñ</h2>
        <div class="box"><div style="display:flex; gap:10px;"><input id="addContactInput" placeholder="–ù—ñ–∫ –∞–±–æ ID" style="margin:0;"><button class="btn-gold" style="width:auto; margin:0;" onclick="addContact()">+</button></div></div>
        <div id="contactsList" style="margin-top:20px;"></div>
    </div>

    <!-- –©–ï -->
    <div id="tab-more" class="screen hidden">
      <div class="box">
        <button class="btn-outline" onclick="openSupportModal()">üí¨ –ß–∞—Ç –ü—ñ–¥—Ç—Ä–∏–º–∫–∏</button>
        <button class="btn-outline" onclick="openDailyBonus()">üéÅ –©–æ–¥–µ–Ω–Ω–∏–π –±–æ–Ω—É—Å</button>
        <button class="btn-outline" onclick="logout()">–í–∏–π—Ç–∏</button>
        <button class="btn-red" onclick="deleteAccount()">–í–ò–î–ê–õ–ò–¢–ò –ê–ö–ê–£–ù–¢</button>
      </div>
    </div>

    <!-- –ê–î–ú–Ü–ù -->
    <div id="tab-admin" class="screen hidden">
       <button class="btn-outline" onclick="switchTab('profile')">‚¨Ö –ù–∞–∑–∞–¥ —É –ü—Ä–æ—Ñ—ñ–ª—å</button>
       <h2 style="color:var(--accent);">–ê–¥–º—ñ–Ω-–ü–∞–Ω–µ–ª—å</h2>
       <div class="box">
           <button class="btn-outline" onclick="loadUserList()">üîÑ –û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤</button>
           <button class="btn-outline" onclick="loadWithdrawRequests()">üí∏ –ó–∞—è–≤–∫–∏ –Ω–∞ –≤–∏–≤—ñ–¥</button>
           <button class="btn-red" onclick="wipeEconomy()">üíÄ –û–ë–ù–£–õ–ò–¢–ò –í–°–Ü–• (1000)</button>
       </div>
       <div id="withdrawRequestsList" class="hidden">
         <div class="section-header">–ó–∞—è–≤–∫–∏ –Ω–∞ –≤–∏–≤—ñ–¥</div>
         <div id="withdrawRequestsContent"></div>
       </div>
       <h3 style="color:#fff; margin-top:15px;">–°–ø–∏—Å–æ–∫ –≥—Ä–∞–≤—Ü—ñ–≤:</h3>
       <div id="userList" style="margin-top:10px;">–ù–∞—Ç–∏—Å–Ω—ñ—Ç—å "–û–Ω–æ–≤–∏—Ç–∏ —Å–ø–∏—Å–æ–∫"</div>
    </div>
  </div>

  <!-- AUTH -->
  <div id="auth-screen" class="full-modal">
      <div style="text-align:center; margin-bottom:30px;"><h1 style="color:var(--accent); font-size:50px; font-style:italic; font-weight:900;">SlotOK</h1><div style="color:#555; font-size:13px;">v34 ‚Äî Telegram Deposits</div></div>
      <div id="loginForm">
        <h3 style="color:#fff;">–í—Ö—ñ–¥</h3>
        <input id="loginName" placeholder="–ù—ñ–∫–Ω–µ–π–º">
        <input id="loginPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
        <button class="btn-gold" onclick="authLogin()">–£–í–Ü–ô–¢–ò</button>
        <div style="text-align:center; margin-top:20px; color:#777; cursor:pointer;" onclick="toggleAuthMode(true)">–°—Ç–≤–æ—Ä–∏—Ç–∏ –∞–∫–∞—É–Ω—Ç ‚Üí</div>
      </div>
      <div id="regForm" class="hidden">
        <h3 style="color:#fff;">–†–µ—î—Å—Ç—Ä–∞—Ü—ñ—è</h3>
        <input id="regEmail" placeholder="Email">
        <input id="regName" placeholder="–ù—ñ–∫–Ω–µ–π–º (–±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤)">
        <input id="regPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å (–º—ñ–Ω 8 —Å–∏–º–≤)">
        <button class="btn-green" onclick="authRegister()">–°–¢–í–û–†–ò–¢–ò</button>
        <div style="text-align:center; margin-top:20px; color:#777; cursor:pointer;" onclick="toggleAuthMode(false)">‚Üê –í–∂–µ —î –∞–∫–∞—É–Ω—Ç? –£–≤—ñ–π—Ç–∏</div>
      </div>
  </div>
  
  <!-- MODALS -->
  <div id="admin-user-manage" class="full-modal hidden">
      <button class="btn-outline" onclick="closeModal('admin-user-manage')" style="width:50px;">‚¨Ö</button>
      <h2 id="admManageName" style="color:var(--accent)">–ì—Ä–∞–≤–µ—Ü—å</h2>
      <div class="box">
        <input id="admAmount" type="number" placeholder="–°—É–º–∞ (+ –∞–±–æ -)">
        <button class="btn-green" onclick="admGiveMoney()">–ó–º—ñ–Ω–∏—Ç–∏ –±–∞–ª–∞–Ω—Å</button>
        <input id="admTag" placeholder="–ù–æ–≤–∏–π —Å—Ç–∞—Ç—É—Å">
        <button class="btn-outline" onclick="admSetTag()">–ó–º—ñ–Ω–∏—Ç–∏ —Å—Ç–∞—Ç—É—Å</button>
      </div>
      <div class="box" style="border-color:red;">
        <button class="btn-red" onclick="admBanUser()">üö´ –ó–ê–ë–õ–û–ö–£–í–ê–¢–ò</button>
        <button class="btn-red" onclick="admDeleteUser()">‚ùå –í–ò–î–ê–õ–ò–¢–ò –ê–ö–ê–£–ù–¢</button>
      </div>
  </div>

  <div id="support-modal" class="full-modal hidden">
    <button class="btn-outline" onclick="closeModal('support-modal')" style="width:50px;">‚¨Ö</button>
    <h2>üí¨ –ß–∞—Ç –ü—ñ–¥—Ç—Ä–∏–º–∫–∏</h2>
    <div id="supportChatBox" style="height:300px;overflow-y:auto;background:#111;border:1px solid #333;margin-bottom:10px;padding:10px;border-radius:8px;"></div>
    <div style="display:flex; gap:10px;">
      <input id="supportMsg" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." style="margin-bottom:0;">
      <button class="btn-gold" style="width:auto;margin-bottom:0;" onclick="sendSupportMsg()">‚û§</button>
    </div>
  </div>

  <div id="transfer-modal" class="full-modal hidden">
    <button class="btn-outline" onclick="closeModal('transfer-modal')" style="width:50px;">‚¨Ö</button>
    <h2>üí∏ –ü–µ—Ä–µ–∫–∞–∑ –î—Ä—É–≥—É</h2>
    <input id="transferTo" placeholder="–ù—ñ–∫ –æ—Ç—Ä–∏–º—É–≤–∞—á–∞">
    <input id="transferAmount" type="number" placeholder="–°—É–º–∞ –ø–µ—Ä–µ–∫–∞–∑—É">
    <button class="btn-gold" onclick="sendMoney()">–ù–ê–î–Ü–°–õ–ê–¢–ò</button>
  </div>

  <div id="promo-modal" class="full-modal hidden">
    <button class="btn-outline" onclick="closeModal('promo-modal')" style="width:50px;">‚¨Ö</button>
    <h2>üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</h2>
    <input id="promoInput" placeholder="–í–≤–µ–¥—ñ—Ç—å –∫–æ–¥">
    <button class="btn-gold" onclick="activatePromo()">–ê–ö–¢–ò–í–£–í–ê–¢–ò</button>
  </div>

  <div id="history-modal" class="full-modal hidden">
    <button class="btn-outline" onclick="closeModal('history-modal')" style="width:50px;">‚¨Ö</button>
    <h2>üìú –Ü—Å—Ç–æ—Ä—ñ—è –¢—Ä–∞–Ω–∑–∞–∫—Ü—ñ–π</h2>
    <div id="historyList" style="background:#111; border-radius:8px; border:1px solid #333;"></div>
  </div>

  <div id="view-user-modal" class="full-modal hidden" onclick="closeModal('view-user-modal')">
    <div onclick="event.stopPropagation()" style="margin-top:20vh;">
      <div class="box" style="text-align:center;">
        <div class="avatar-large" id="viewUserAvatar" style="margin:0 auto 15px auto;">üë§</div>
        <h2 style="margin:0; color:var(--accent)" id="viewUserName">Name</h2>
        <div id="viewUserTag" style="color:#777; margin-bottom:5px;"></div>
        <p style="color:#555;">ID: <span id="viewUserId">000</span></p>
        <div style="font-size:28px; font-weight:bold; margin-bottom:20px; color:var(--green);"><span id="viewUserBal">0</span> ‚Ç¥</div>
        <button class="btn-outline" onclick="closeModal('view-user-modal')">–ó–∞–∫—Ä–∏—Ç–∏</button>
      </div>
    </div>
  </div>

  <!-- –©–û–î–ï–ù–ù–ò–ô –ë–û–ù–£–° –ú–û–î–ê–õ -->
  <div id="daily-bonus-modal" class="full-modal hidden">
    <button class="btn-outline" onclick="closeModal('daily-bonus-modal')" style="width:50px;">‚¨Ö</button>
    <div class="daily-bonus-modal-content" id="dailyBonusContent"></div>
  </div>

  <nav class="bottom-nav">
    <div class="nav-item active" onclick="switchTab('home', this)"><span class="icon">üè†</span><span>–ì–æ–ª–æ–≤–Ω–∞</span></div>
    <div class="nav-item" onclick="switchTab('lobby', this)"><span class="icon">üé∞</span><span>–ö–∞–∑–∏–Ω–æ</span></div>
    <div class="nav-item" onclick="switchTab('cashier', this)"><span class="icon">üí≥</span><span>–ö–∞—Å–∞</span></div>
    <div class="nav-item" onclick="switchTab('top', this)"><span class="icon">üèÜ</span><span>–¢–æ–ø</span></div>
    <div class="nav-item" onclick="switchTab('profile', this)"><span class="icon">üë§</span><span>–ü—Ä–æ—Ñ—ñ–ª—å</span></div>
    <div class="nav-item" onclick="switchTab('contacts', this)"><span class="icon">üë•</span><span>–ó–Ω–∞–π–æ–º—ñ</span></div>
    <div class="nav-item" onclick="switchTab('more', this)"><span class="icon">‚öôÔ∏è</span><span>–©–µ</span></div>
  </nav>

  <script>
    // ============================================
    // –Ü–ù–Ü–¶–Ü–ê–õ–Ü–ó–ê–¶–Ü–Ø
    // ============================================
    setTimeout(() => {
        const loader = document.getElementById('loading-overlay');
        if(loader) { loader.style.opacity = '0'; setTimeout(() => loader.classList.add('hidden'), 500); }
    }, 1500);

    const firebaseConfig = { 
        apiKey: "AIzaSyB0gJDyr8z2SWPV3Tf73ZRNNPuglxHTCZw", 
        authDomain: "slotok-web-server.firebaseapp.com", 
        databaseURL: "https://slotok-web-server-default-rtdb.firebaseio.com", 
        projectId: "slotok-web-server", 
        storageBucket: "slotok-web-server.firebasestorage.app", 
        messagingSenderId: "1086314476940", 
        appId: "1:1086314476940:web:d3629d2d0fe16f7c1f12a9" 
    };
    
    try { if (!firebase.apps.length) firebase.initializeApp(firebaseConfig); } 
    catch(e) { console.error("Firebase init error", e); }
    const db = firebase.database();

    // ============================================
    // –û–°–ù–û–í–ù–Ü –ó–ú–Ü–ù–ù–Ü
    // ============================================
    let currentUser = null; 
    let userData = {}; 
    let currentRouletteBet = null;
    let selectedWithdrawMethod = 'privat';
    let selectedDepAmount = 0;
    const MAX_BET = 100000; 
    let audioCtx = null;

    // Telegram Bot Username ‚Äî –∑–∞–º—ñ–Ω–∏—Ç–∏ –Ω–∞ —Å–≤—ñ–π!
    const TG_BOT_USERNAME = 'SlotOK_DepositBot';

    // ============================================
    // –ü–ï–†–ï–í–Ü–†–ö–ê –õ–û–ì–Ü–ù–£
    // ============================================
    const savedUser = localStorage.getItem("royal_online_user");
    if(savedUser) { currentUser = savedUser; startDataSync(); }

    function startDataSync() {
        try {
            db.ref('users/' + currentUser).on('value', (snapshot) => {
                const data = snapshot.val();
                if(!data) { logout(); return; }
                userData = data; 
                if(userData.banned) { alert("–í–ê–® –ê–ö–ê–£–ù–¢ –ó–ê–ë–õ–û–ö–û–í–ê–ù–û!"); logout(); return; }
                document.getElementById('auth-screen').classList.add('hidden');
                updateUI(); 
                loadContacts(); 
                checkAdmin();
                checkDailyBonus();
            }, (error) => {
                notify("–ü–æ–º–∏–ª–∫–∞ –∑–≤'—è–∑–∫—É –∑ –±–∞–∑–æ—é.", "error");
            });
            db.ref('users').orderByChild('balance').limitToLast(20).on('value', snap => renderTop(snap.val()));
        } catch(e) { console.error("Sync error:", e); }
    }

    // ============================================
    // –Ü–ù–¢–ï–†–§–ï–ô–°
    // ============================================
    function updateUI() {
        if(!userData) return;
        document.querySelectorAll('.bal').forEach(e => e.textContent = formatNumber(userData.balance));
        document.getElementById('profileName').textContent = currentUser;
        document.getElementById('profileId').textContent = userData.id || '---';
        document.getElementById('profileEmail').textContent = userData.email || "-";
        document.getElementById('profileTag').textContent = userData.tag || "–ì—Ä–∞–≤–µ—Ü—å";
        document.getElementById('cashierUserId').textContent = userData.id || '---';
        const avDiv = document.getElementById('currentAvatar');
        avDiv.innerHTML = (userData.avatar && userData.avatar.length > 20) ? `<img src="${userData.avatar}">` : 'üë§';
        loadMyWithdraws();
    }

    function checkAdmin() {
        if (currentUser.toLowerCase() === 'theivankoo' || userData.isAdmin === true) {
            document.getElementById('adminPanelBtnBox').classList.remove('hidden');
            document.getElementById('adminBadge').classList.remove('hidden');
        } else {
            document.getElementById('adminPanelBtnBox').classList.add('hidden');
            document.getElementById('adminBadge').classList.add('hidden');
        }
    }

    function formatNumber(num) {
        if(num >= 1000000000) return (num/1000000000).toFixed(1) + 'B';
        if(num >= 1000000) return (num/1000000).toFixed(1) + 'M';
        if(num >= 1000) return (num/1000).toFixed(1) + 'k';
        return Math.floor(num).toLocaleString();
    }

    function notify(msg, type='info') { 
        const c = document.getElementById('toast-container'); 
        const d = document.createElement('div'); 
        d.className = `toast ${type}`; 
        d.innerHTML = `<span>${msg}</span>`; 
        c.appendChild(d); 
        setTimeout(() => d.remove(), 3500); 
    }
    
    function playSound(type) { 
        try {
            if(!audioCtx) audioCtx = new (window.AudioContext || window.webkitAudioContext)();
            if(audioCtx.state === 'suspended') audioCtx.resume(); 
            const o = audioCtx.createOscillator(); 
            const g = audioCtx.createGain(); 
            o.connect(g); g.connect(audioCtx.destination); 
            const t = audioCtx.currentTime; 
            if(type === 'click'){ o.frequency.value = 600; g.gain.exponentialRampToValueAtTime(0.01, t+0.1); o.start(t); o.stop(t+0.1); } 
            else if(type === 'win'){ o.type = 'triangle'; o.frequency.setValueAtTime(500, t); o.frequency.linearRampToValueAtTime(1000, t+0.5); g.gain.linearRampToValueAtTime(0, t+0.5); o.start(t); o.stop(t+0.5); } 
        } catch(e) {} 
    }
    
    function validateBet(amount) { 
        const bet = Math.abs(parseInt(amount)); 
        if(isNaN(bet) || bet <= 0 || bet > MAX_BET || userData.balance < bet) { 
            notify("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤ –∞–±–æ –Ω–µ–≤—ñ—Ä–Ω–∞ —Å—É–º–∞!", "error"); 
            return false; 
        } 
        return bet; 
    }
    
    function addToHistory(msg) { 
        try { db.ref(`users/${currentUser}/history`).push({text: msg, date: Date.now()}); } catch(e){} 
    }

    // ============================================
    // –©–û–î–ï–ù–ù–ò–ô –ë–û–ù–£–°
    // ============================================
    const DAILY_BONUSES = [100, 150, 200, 300, 500, 750, 1000];

    function checkDailyBonus() {
        const lastClaim = userData.lastDailyBonus || 0;
        const now = Date.now();
        const dayMs = 24 * 60 * 60 * 1000;
        const canClaim = (now - lastClaim) >= dayMs;
        
        const banner = document.getElementById('dailyBonusBanner');
        if(canClaim) {
            banner.style.display = 'flex';
            banner.classList.remove('hidden');
        } else {
            banner.classList.add('hidden');
        }
    }

    function openDailyBonus() {
        const lastClaim = userData.lastDailyBonus || 0;
        const now = Date.now();
        const dayMs = 24 * 60 * 60 * 1000;
        const canClaim = (now - lastClaim) >= dayMs;
        const streak = userData.dailyStreak || 0;
        const bonusAmount = DAILY_BONUSES[Math.min(streak, 6)];
        
        const content = document.getElementById('dailyBonusContent');
        
        if(canClaim) {
            content.innerHTML = `
                <div class="bonus-icon">üéÅ</div>
                <h2 style="color:var(--accent);">–©–æ–¥–µ–Ω–Ω–∏–π –ë–æ–Ω—É—Å!</h2>
                <div style="color:#aaa; margin-bottom:10px;">–î–µ–Ω—å ${streak + 1} —Å–µ—Ä—ñ—ó</div>
                <div class="bonus-amount">+${bonusAmount} ‚Ç¥</div>
                <div class="streak-dots">
                    ${DAILY_BONUSES.map((b, i) => `
                        <div class="streak-dot ${i < streak ? 'done' : i === streak ? 'today' : ''}" title="${b}‚Ç¥">
                            ${i < streak ? '‚úì' : i === streak ? '‚òÖ' : i+1}
                        </div>
                    `).join('')}
                </div>
                <div style="color:#aaa; font-size:12px; margin-bottom:20px;">7 –¥–Ω—ñ–≤ –ø–æ—Å–ø—ñ–ª—å = 1000‚Ç¥</div>
                <button class="btn-gold" style="font-size:18px; padding:18px;" onclick="claimDailyBonus(${bonusAmount})">
                    üéÅ –ó–ê–ë–†–ê–¢–ò ${bonusAmount} ‚Ç¥
                </button>
            `;
        } else {
            const msLeft = dayMs - (now - lastClaim);
            const h = Math.floor(msLeft / 3600000);
            const m = Math.floor((msLeft % 3600000) / 60000);
            content.innerHTML = `
                <div style="font-size:60px; margin-bottom:20px;">‚è∞</div>
                <h2 style="color:#777;">–í–∂–µ –∑–∞–±—Ä–∞–Ω–æ</h2>
                <div style="color:#aaa; margin-bottom:10px;">–ù–∞—Å—Ç—É–ø–Ω–∏–π –±–æ–Ω—É—Å —á–µ—Ä–µ–∑:</div>
                <div style="font-size:36px; font-weight:900; color:var(--accent);">${h}–≥–æ–¥ ${m}—Ö–≤</div>
                <div style="color:#aaa; margin:15px 0; font-size:13px;">–í–∞—à–∞ —Å–µ—Ä—ñ—è: ${streak} –¥–Ω—ñ–≤ üî•</div>
                <div class="streak-dots">
                    ${DAILY_BONUSES.map((b, i) => `
                        <div class="streak-dot ${i < streak ? 'done' : ''}" title="${b}‚Ç¥">
                            ${i < streak ? '‚úì' : i+1}
                        </div>
                    `).join('')}
                </div>
                <button class="btn-outline" onclick="closeModal('daily-bonus-modal')" style="margin-top:20px;">–ó–∞–∫—Ä–∏—Ç–∏</button>
            `;
        }
        openModal('daily-bonus-modal');
    }

    function claimDailyBonus(amount) {
        const streak = (userData.dailyStreak || 0) + 1;
        const newStreak = streak >= 7 ? 0 : streak; // –°–∫–∏–¥–∞—î–º–æ –ø—ñ—Å–ª—è 7 –¥–Ω—ñ–≤
        
        db.ref('users/' + currentUser).update({
            balance: userData.balance + amount,
            lastDailyBonus: Date.now(),
            dailyStreak: newStreak
        });
        
        playSound('win');
        notify(`üéÅ –©–æ–¥–µ–Ω–Ω–∏–π –±–æ–Ω—É—Å: +${amount} ‚Ç¥`, 'success');
        addToHistory(`Daily Bonus: +${amount}`);
        closeModal('daily-bonus-modal');
        document.getElementById('dailyBonusBanner').classList.add('hidden');
    }

    // ============================================
    // TELEGRAM –î–ï–ü–û–ó–ò–¢
    // ============================================
    function selectDepAmount(amount, el) {
        selectedDepAmount = amount;
        document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
        document.getElementById('customAmountBox').classList.add('hidden');
    }

    function selectCustomAmount() {
        document.querySelectorAll('.amount-btn').forEach(b => b.classList.remove('selected'));
        document.getElementById('customAmtBtn').classList.add('selected');
        document.getElementById('customAmountBox').classList.remove('hidden');
        selectedDepAmount = 0;
    }

    function openTelegramBot() {
        const customInput = document.getElementById('customDepAmount');
        let amount = selectedDepAmount;
        if(amount === 0 && customInput.value) amount = parseInt(customInput.value);
        
        if(!amount || amount < 50) {
            notify("–û–±–µ—Ä—ñ—Ç—å —Å—É–º—É –ø–æ–ø–æ–≤–Ω–µ–Ω–Ω—è (–º—ñ–Ω. 50‚Ç¥)", "error");
            return;
        }

        const userId = userData.id;
        const userName = currentUser;
        
        // Deep link –∑ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏ –¥–ª—è –±–æ—Ç–∞
        // –ë–æ—Ç –æ—Ç—Ä–∏–º–∞—î: /start dep_USERID_AMOUNT
        const startParam = `dep_${userId}_${amount}`;
        const tgUrl = `https://t.me/${TG_BOT_USERNAME}?start=${startParam}`;
        
        // –í—ñ–¥–∫—Ä–∏–≤–∞—î–º–æ –±–æ—Ç
        window.open(tgUrl, '_blank');
        
        notify(`–í—ñ–¥–∫—Ä–∏–≤–∞—î—Ç—å—Å—è Telegram –±–æ—Ç. –í–∞—à ID: ${userId}`, 'info');
        notify(`–°—É–º–∞: ${amount} ‚Ç¥ ‚Äî –ø–µ—Ä–µ–¥–∞–Ω–∞ –±–æ—Ç—É –∞–≤—Ç–æ–º–∞—Ç–∏—á–Ω–æ`, 'success');
        
        // –§—ñ–∫—Å—É—î–º–æ –∑–∞–ø–∏—Ç –¥–µ–ø–æ–∑–∏—Ç—É –≤ –±–∞–∑—ñ (–¥–ª—è –∞–¥–º—ñ–Ω–∞)
        db.ref(`deposit_requests/${userId}_${Date.now()}`).set({
            user: userName,
            userId: userId,
            amount: amount,
            status: 'pending',
            method: 'telegram',
            time: Date.now()
        });
    }

    // ============================================
    // –í–ò–í–Ü–î –ö–û–®–¢–Ü–í
    // ============================================
    function selectWithdrawMethod(method, el) {
        selectedWithdrawMethod = method;
        document.querySelectorAll('.wm-btn').forEach(b => b.classList.remove('selected'));
        el.classList.add('selected');
        
        const cardInput = document.getElementById('withdrawCard');
        if(method === 'usdt') {
            cardInput.placeholder = 'USDT TRC20 –∞–¥—Ä–µ—Å–∞';
        } else if(method === 'privat') {
            cardInput.placeholder = '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏ PrivatBank';
        } else {
            cardInput.placeholder = '–ù–æ–º–µ—Ä –∫–∞—Ä—Ç–∫–∏ Monobank';
        }
    }

    function submitWithdraw() {
        const card = document.getElementById('withdrawCard').value.trim();
        const amount = parseInt(document.getElementById('withdrawAmount').value);
        
        if(!card) return notify("–í–≤–µ–¥—ñ—Ç—å —Ä–µ–∫–≤—ñ–∑–∏—Ç–∏ –¥–ª—è –≤–∏–≤–æ–¥—É", "error");
        if(!amount || amount < 200) return notify("–ú—ñ–Ω—ñ–º–∞–ª—å–Ω–∞ —Å—É–º–∞ –≤–∏–≤–æ–¥—É: 200‚Ç¥", "error");
        if(userData.balance < amount) return notify("–ù–µ–¥–æ—Å—Ç–∞—Ç–Ω—å–æ –∫–æ—à—Ç—ñ–≤", "error");
        
        // –ü–µ—Ä–µ–≤—ñ—Ä–∫–∞ –Ω–∞ pending –∑–∞—è–≤–∫–∏
        if(userData.pendingWithdraw) {
            return notify("–£ –≤–∞—Å –≤–∂–µ —î –∞–∫—Ç–∏–≤–Ω–∞ –∑–∞—è–≤–∫–∞ –Ω–∞ –≤–∏–≤—ñ–¥. –î–æ—á–µ–∫–∞–π—Ç–µ—Å—å —ó—ó –æ–±—Ä–æ–±–∫–∏.", "error");
        }
        
        const requestId = `${currentUser}_${Date.now()}`;
        
        // –ó–∞–º–æ—Ä–æ–∑–∏—Ç–∏ –≥—Ä–æ—à—ñ
        db.ref('users/' + currentUser).update({
            balance: userData.balance - amount,
            pendingWithdraw: true
        });
        
        // –ó–±–µ—Ä–µ–≥—Ç–∏ –∑–∞—è–≤–∫—É
        db.ref('withdraw_requests/' + requestId).set({
            user: currentUser,
            userId: userData.id,
            amount: amount,
            method: selectedWithdrawMethod,
            card: card,
            status: 'pending',
            time: Date.now()
        });
        
        db.ref('users/' + currentUser + '/withdraws/' + requestId).set({
            amount: amount,
            method: selectedWithdrawMethod,
            status: 'pending',
            time: Date.now()
        });
        
        addToHistory(`–ó–∞—è–≤–∫–∞ –Ω–∞ –≤–∏–≤—ñ–¥: -${amount} ‚Ç¥ (–æ–±—Ä–æ–±–ª—è—î—Ç—å—Å—è)`);
        notify(`‚úÖ –ó–∞—è–≤–∫—É –Ω–∞ –≤–∏–≤—ñ–¥ ${amount}‚Ç¥ –ø—Ä–∏–π–Ω—è—Ç–æ! –û–±—Ä–æ–±–∫–∞ 1-24 –≥–æ–¥.`, 'success');
        
        document.getElementById('withdrawCard').value = '';
        document.getElementById('withdrawAmount').value = '';
        loadMyWithdraws();
    }

    function loadMyWithdraws() {
        const list = document.getElementById('myWithdrawsList');
        if(!list) return;
        
        db.ref('users/' + currentUser + '/withdraws').limitToLast(5).once('value', snap => {
            const data = snap.val();
            if(!data) { list.innerHTML = '<div style="color:#777; font-size:13px; padding:10px 0;">–ù–µ–º–∞—î –∑–∞—è–≤–æ–∫</div>'; return; }
            
            list.innerHTML = '';
            Object.entries(data).reverse().forEach(([id, w]) => {
                const date = new Date(w.time).toLocaleDateString('uk-UA');
                const statusClass = w.status === 'done' ? 'pw-done' : 'pw-pending';
                const statusText = w.status === 'done' ? '‚úÖ –í–∏–∫–æ–Ω–∞–Ω–æ' : '‚è≥ –û–±—Ä–æ–±–ª—è—î—Ç—å—Å—è';
                list.innerHTML += `
                    <div class="pending-withdraw">
                        <div>
                            <div style="font-weight:bold;">${w.amount} ‚Ç¥</div>
                            <div style="color:#777; font-size:11px;">${w.method} ‚Ä¢ ${date}</div>
                        </div>
                        <span class="pw-status ${statusClass}">${statusText}</span>
                    </div>
                `;
            });
        });
    }

    // ============================================
    // –Ü–ì–†–ò
    // ============================================

    // --- –°–ª–æ—Ç–∏ ---
    function spinSlots() { 
        const b = validateBet(document.getElementById('betAmountSlots').value); 
        if(!b) return; 
        db.ref('users/'+currentUser).update({balance: userData.balance - b}); 
        playSound('click'); 
        const reels = [document.getElementById('r1'), document.getElementById('r2'), document.getElementById('r3')]; 
        const sym = ["üçí", "üçã", "7", "üíé", "üîî"]; 
        let count = 0; 
        let int = setInterval(() => { 
            reels.forEach(r => r.textContent = sym[Math.floor(Math.random()*sym.length)]); 
            count++; 
            if(count > 15) { clearInterval(int); finishSlots(b); } 
        }, 80); 
    }
    
    function finishSlots(bet) { 
        const r = Math.random(); 
        let win = 0; let res = ["üçí","üçã","üîî"]; 
        if(r < 0.03) { res = ["7","7","7"]; win = bet*50; } 
        else if(r < 0.08) { res = ["üíé","üíé","üíé"]; win = bet*15; } 
        else if(r < 0.20) { res = ["üçí","üçí","üçí"]; win = bet*3; } 
        else if(r < 0.35) { res = ["üîî","üîî","üçã"]; win = bet*1.5; }
        
        document.getElementById('r1').textContent = res[0]; 
        document.getElementById('r2').textContent = res[1]; 
        document.getElementById('r3').textContent = res[2]; 
        
        if(win > 0) { 
            db.ref('users/'+currentUser+'/balance').set(firebase.database.ServerValue.increment(win)); 
            playSound('win'); 
            notify(`üé∞ WIN: ${win} ‚Ç¥`, "success"); 
            addToHistory(`Slots: +${win}`); 
        } 
    }

    // --- –†—É–ª–µ—Ç–∫–∞ ---
    function selectRouletteBet(c, e){ 
        document.querySelectorAll('.bet-btn').forEach(b => b.classList.remove('selected')); 
        e.classList.add('selected'); 
        currentRouletteBet = c; 
        playSound('click'); 
    }
    
    function spinRoulette(){ 
        const b = validateBet(document.getElementById('betAmountRoulette').value); 
        if(!b || !currentRouletteBet) { notify("–û–±–µ—Ä—ñ—Ç—å –∫–æ–ª—ñ—Ä —ñ —Å—Ç–∞–≤–∫—É"); return; }
        db.ref('users/'+currentUser).update({balance: userData.balance - b}); 
        playSound('click'); 
        const wheel = document.getElementById('wheel'); 
        const randDeg = Math.random() * 360; 
        wheel.style.transform = `rotate(${1800 + (360 - randDeg)}deg)`; 
        setTimeout(() => { 
            let win = 0; let c = 'black'; 
            if(randDeg <= 18) c = 'green'; 
            else if(randDeg <= 189) c = 'red'; 
            if(c === currentRouletteBet){ 
                win = (c === 'green') ? b*14 : b*2; 
                db.ref('users/'+currentUser+'/balance').set(userData.balance + win); 
                notify(`üé° –í–∏–≥—Ä–∞—à: ${win} ‚Ç¥`, "success"); 
                playSound('win'); 
                addToHistory(`Roulette: +${win}`); 
            } else { notify("–ü—Ä–æ–≥—Ä–∞—à üòî", "error"); } 
        }, 4000); 
    }

    // --- –°—É–Ω–¥—É–∫–∏ ---
    function startChests(){ 
        const b = validateBet(document.getElementById('betAmountChests').value); 
        if(!b) return; 
        db.ref('users/'+currentUser).update({balance: userData.balance - b}); 
        const g = document.getElementById('chestsGrid'); 
        g.innerHTML = ""; 
        for(let i=0; i<3; i++){ 
            const d = document.createElement('div'); 
            d.className = "chest-item"; 
            d.textContent = "üì¶"; 
            d.onclick = () => { 
                const w = Math.random() > 0.6 ? b*2.5 : 0; 
                d.textContent = w ? "üí∞" : "üí®"; 
                if(w){ db.ref('users/'+currentUser+'/balance').set(firebase.database.ServerValue.increment(w)); playSound('win'); notify(`+${w} ‚Ç¥`, "success"); addToHistory(`Chests: +${w}`); } 
                else { playSound('click'); }
                Array.from(g.children).forEach(c => c.onclick = null);
            }; 
            g.appendChild(d); 
        }
    }

    // --- –ö—Ä–∞—à ---
    let crashInt; let isCrashPlaying = false;
    function startCrash() { 
        const b = validateBet(document.getElementById('betAmountCrash').value); 
        if(!b) return; 
        db.ref('users/'+currentUser).update({balance: userData.balance - b}); 
        document.getElementById('crashBtn').classList.add('hidden'); 
        document.getElementById('crashCashoutBtn').classList.remove('hidden'); 
        let m = 1.00; 
        let crashPoint = 1 + (Math.random() * 8);
        isCrashPlaying = true; 
        crashInt = setInterval(() => { 
            m += 0.03 + (m * 0.002); 
            document.getElementById('crashDisplay').textContent = m.toFixed(2) + 'x'; 
            if(m >= crashPoint){ 
                clearInterval(crashInt); 
                isCrashPlaying = false; 
                notify("üí• –ö–†–ê–® –Ω–∞ " + m.toFixed(2) + "x!", "error"); 
                document.getElementById('crashDisplay').style.color = "red";
                setTimeout(()=> { document.getElementById('crashDisplay').style.color = "white"; document.getElementById('crashDisplay').textContent = "1.00x"; }, 2000);
                document.getElementById('crashBtn').classList.remove('hidden'); 
                document.getElementById('crashCashoutBtn').classList.add('hidden'); 
            } 
        }, 100); 
    }
    
    function cashoutCrash() { 
        if(!isCrashPlaying) return; 
        clearInterval(crashInt); 
        isCrashPlaying = false; 
        const b = parseInt(document.getElementById('betAmountCrash').value); 
        const mult = parseFloat(document.getElementById('crashDisplay').textContent);
        const w = Math.floor(b * mult); 
        db.ref('users/'+currentUser+'/balance').set(userData.balance + w); 
        notify(`üöÄ –í–∏–≤–µ–¥–µ–Ω–æ: +${w} ‚Ç¥`, "success"); 
        addToHistory(`Crash: +${w} (x${mult})`); 
        document.getElementById('crashBtn').classList.remove('hidden'); 
        document.getElementById('crashCashoutBtn').classList.add('hidden'); 
    }

    // ============================================
    // –í–Ü–î–ï–û–ü–û–ö–ï–†
    // ============================================
    const SUITS = ['‚ô†', '‚ô•', '‚ô¶', '‚ô£'];
    const RANKS = ['2','3','4','5','6','7','8','9','10','J','Q','K','A'];
    const RANK_VALUES = {2:2,3:3,4:4,5:5,6:6,7:7,8:8,9:9,10:10,J:11,Q:12,K:13,A:14};

    let pokerHand = [];
    let pokerSelectedCards = [];
    let pokerBet = 0;
    let pokerPhase = 'deal'; // 'deal' –∞–±–æ 'draw'

    function createDeck() {
        const deck = [];
        for(const suit of SUITS) for(const rank of RANKS) deck.push({rank, suit});
        return deck.sort(() => Math.random() - 0.5);
    }

    function cardHTML(card, index, selectable=false) {
        const isRed = card.suit === '‚ô•' || card.suit === '‚ô¶';
        const colorClass = isRed ? 'red-card' : '';
        const selectedClass = pokerSelectedCards.includes(index) ? 'selected' : '';
        const onclick = selectable ? `onclick="togglePokerCard(${index})"` : '';
        return `<div class="card ${colorClass} ${selectedClass}" ${onclick} data-idx="${index}">
            <span style="font-size:11px;">${card.rank}</span>
            <span style="font-size:16px;">${card.suit}</span>
        </div>`;
    }

    function togglePokerCard(idx) {
        if(pokerPhase !== 'draw') return;
        const pos = pokerSelectedCards.indexOf(idx);
        if(pos === -1) pokerSelectedCards.push(idx);
        else pokerSelectedCards.splice(pos, 1);
        renderPokerHand(true);
    }

    function renderPokerHand(selectable=false) {
        const container = document.getElementById('pokerCards');
        container.innerHTML = pokerHand.map((c, i) => cardHTML(c, i, selectable)).join('');
    }

    function dealPoker() {
        const b = validateBet(document.getElementById('betAmountPoker').value);
        if(!b) return;
        pokerBet = b;
        db.ref('users/'+currentUser).update({balance: userData.balance - b});
        
        const deck = createDeck();
        pokerHand = deck.slice(0, 5);
        pokerSelectedCards = [];
        pokerPhase = 'draw';
        
        renderPokerHand(true);
        document.getElementById('pokerInfo').textContent = 'üîÑ –û–±–µ—Ä—ñ—Ç—å –∫–∞—Ä—Ç–∏ –¥–ª—è –ó–ê–ú–Ü–ù–ò (–∞–±–æ –Ω–µ –æ–±–∏—Ä–∞–π—Ç–µ)';
        document.getElementById('pokerDealBtn').classList.add('hidden');
        document.getElementById('pokerDrawBtn').classList.remove('hidden');
        playSound('click');
    }

    function drawPoker() {
        // –ó–∞–º—ñ–Ω—é—î–º–æ –≤–∏–¥—ñ–ª–µ–Ω—ñ –∫–∞—Ä—Ç–∏
        const deck = createDeck().filter(c => !pokerHand.find(h => h.rank===c.rank && h.suit===c.suit));
        let di = 0;
        pokerSelectedCards.forEach(idx => { pokerHand[idx] = deck[di++]; });
        pokerSelectedCards = [];
        pokerPhase = 'deal';
        
        renderPokerHand(false);
        
        const result = evaluatePokerHand(pokerHand);
        const win = Math.floor(pokerBet * result.multiplier);
        
        if(win > 0) {
            db.ref('users/'+currentUser+'/balance').set(firebase.database.ServerValue.increment(win));
            playSound('win');
            notify(`üÉè ${result.name}! +${win} ‚Ç¥`, 'success');
            addToHistory(`Poker ${result.name}: +${win}`);
            document.getElementById('pokerInfo').innerHTML = `<span style="color:var(--green); font-weight:bold;">üèÜ ${result.name}! –í–∏–≥—Ä–∞—à: +${win} ‚Ç¥</span>`;
        } else {
            notify('üòî –ù—ñ—á–æ–≥–æ –Ω–µ–º–∞—î', 'error');
            document.getElementById('pokerInfo').textContent = result.name + ' ‚Äî –ø—Ä–æ–≥—Ä–∞—à';
        }
        
        document.getElementById('pokerDealBtn').classList.remove('hidden');
        document.getElementById('pokerDrawBtn').classList.add('hidden');
    }

    function evaluatePokerHand(hand) {
        const ranks = hand.map(c => RANK_VALUES[c.rank]).sort((a,b) => a-b);
        const suits = hand.map(c => c.suit);
        const rankStr = hand.map(c => c.rank);
        
        const isFlush = suits.every(s => s === suits[0]);
        const isStraight = ranks[4]-ranks[0]===4 && new Set(ranks).size===5 || 
                          (ranks.join(',') === '2,3,4,5,14'); // Wheel
        
        const rankCount = {};
        rankStr.forEach(r => rankCount[r] = (rankCount[r]||0)+1);
        const counts = Object.values(rankCount).sort((a,b) => b-a);
        
        if(isFlush && isStraight && ranks[0]===10) return {name:'–†–æ—è–ª-—Ñ–ª–µ—à üëë', multiplier:800};
        if(isFlush && isStraight) return {name:'–°—Ç—Ä–µ–π—Ç-—Ñ–ª–µ—à', multiplier:50};
        if(counts[0]===4) return {name:'–ö–∞—Ä–µ', multiplier:25};
        if(counts[0]===3 && counts[1]===2) return {name:'–§—É–ª-—Ö–∞—É—Å', multiplier:9};
        if(isFlush) return {name:'–§–ª–µ—à', multiplier:6};
        if(isStraight) return {name:'–°—Ç—Ä–µ–π—Ç', multiplier:4};
        if(counts[0]===3) return {name:'–¢—Ä–∏ –æ–¥–Ω–∞–∫–æ–≤–∏—Ö', multiplier:3};
        if(counts[0]===2 && counts[1]===2) return {name:'–î–≤—ñ –ø–∞—Ä–∏', multiplier:2};
        
        // –ü–∞—Ä–∞ JJ+
        if(counts[0]===2) {
            const pairRank = Object.keys(rankCount).find(r => rankCount[r]===2);
            if(['J','Q','K','A'].includes(pairRank)) return {name:`–ü–∞—Ä–∞ ${pairRank}`, multiplier:1};
        }
        
        return {name:'–ù—ñ—á–æ–≥–æ', multiplier:0};
    }

    function togglePaytable() {
        const pt = document.getElementById('pokerPaytable');
        pt.style.display = pt.style.display === 'none' ? 'block' : 'none';
    }

    // --- –°–∞–ø–µ—Ä ---
    let minesGrid = []; let isMinesPlaying = false; let currentMinesProfit = 0; let movesMade = 0;
    function startMines() { 
        const bet = validateBet(document.getElementById('betAmountMines').value); 
        if(!bet) return; 
        db.ref('users/'+currentUser).update({balance: userData.balance - bet}); 
        isMinesPlaying = true; currentMinesProfit = bet; movesMade = 0; 
        document.getElementById('minesBtn').classList.add('hidden'); 
        document.getElementById('minesCashoutBtn').classList.remove('hidden'); 
        document.getElementById('minesCashoutBtn').textContent = `–ó–ê–ë–†–ê–¢–ò (0)`;
        minesGrid = new Array(25).fill(0); 
        let placed = 0; 
        while(placed < 3) { let idx = Math.floor(Math.random()*25); if(minesGrid[idx]===0){ minesGrid[idx]=1; placed++; } } 
        const container = document.getElementById('minesGrid'); 
        container.innerHTML = ''; 
        for(let i=0; i<25; i++){ 
            const cell = document.createElement('div'); 
            cell.className='mine-cell'; cell.textContent="‚ùì"; 
            cell.onclick = () => clickMineCell(i, cell); 
            container.appendChild(cell); 
        } 
        playSound('click'); 
    }
    
    function clickMineCell(idx, el) { 
        if(!isMinesPlaying || el.classList.contains('revealed')) return; 
        el.classList.add('revealed'); 
        if(minesGrid[idx]===1){ 
            el.textContent="üí£"; playSound('click'); notify("üí£ –ë—É–º! –ü—Ä–æ–≥—Ä–∞—à", "error"); 
            isMinesPlaying=false;
            document.getElementById('minesBtn').classList.remove('hidden'); 
            document.getElementById('minesCashoutBtn').classList.add('hidden'); 
        } else { 
            el.textContent="üíé"; playSound('click'); movesMade++; 
            currentMinesProfit=Math.floor(currentMinesProfit*1.25); 
            document.getElementById('minesCashoutBtn').textContent=`–ó–ê–ë–†–ê–¢–ò ${currentMinesProfit} ‚Ç¥`; 
        } 
    }
    
    function cashoutMines() { 
        if(!isMinesPlaying || movesMade===0) return; 
        db.ref('users/'+currentUser+'/balance').set(userData.balance+currentMinesProfit); 
        playSound('win'); notify(`üíé –í–∏–≤–µ–¥–µ–Ω–æ: +${currentMinesProfit} ‚Ç¥`, "success"); 
        addToHistory(`Mines: +${currentMinesProfit}`); 
        isMinesPlaying=false;
        document.getElementById('minesBtn').classList.remove('hidden'); 
        document.getElementById('minesCashoutBtn').classList.add('hidden'); 
    }

    // --- –ü–ª—ñ–Ω–∫–æ ---
    function dropPlinko() { 
        const bet = validateBet(document.getElementById('betAmountPlinko').value); 
        if(!bet) return; 
        db.ref('users/'+currentUser).update({balance: userData.balance - bet}); 
        playSound('click'); 
        const ball = document.getElementById('plinkoBall'); 
        ball.style.display='block'; 
        const rand = Math.random(); 
        let bucketIndex = 3; 
        if(rand < 0.10) bucketIndex=0; 
        else if(rand < 0.30) bucketIndex=1; 
        else if(rand < 0.60) bucketIndex=2; 
        else bucketIndex=3; 
        if(Math.random()>0.5) bucketIndex=6-bucketIndex; 
        const targetLeft=(bucketIndex*14)+7; 
        ball.animate([{top:'0',left:'50%'},{top:'100%',left:targetLeft+'%'}],{duration:1500,fill:'forwards',easing:'linear'}); 
        setTimeout(() => { 
            const multipliers=[5,2,0.5,0.2,0.5,2,5]; 
            const mult=multipliers[bucketIndex]; 
            const win=Math.floor(bet*mult); 
            if(mult>=1){ db.ref('users/'+currentUser+'/balance').set(userData.balance+win); playSound('win'); notify(`üîª +${win} ‚Ç¥`, "success"); addToHistory(`Plinko: +${win}`); } 
            else { addToHistory(`Plinko: -${bet-win}`); } 
            ball.style.display='none'; 
        }, 1500); 
    }

    // ============================================
    // –†–ï–ô–¢–ò–ù–ì
    // ============================================
    function renderTop(d) {
        if(!d) return;
        let arr = [];
        for(let k in d) arr.push({n:k, ...d[k]});
        arr.sort((a,b) => b.balance - a.balance);
        let h = "";
        arr.forEach((u,i) => {
            const av = u.avatar && u.avatar.length > 20 ? `<img src="${u.avatar}" style="width:24px;height:24px;border-radius:50%;vertical-align:middle;">` : 'üë§';
            const medal = i===0?'ü•á':i===1?'ü•à':i===2?'ü•â':`${i+1}`;
            h += `<tr onclick="openUserProfile('${u.n}')" style="cursor:pointer;">
                    <td style="font-size:16px;">${medal}</td>
                    <td>${av} <b>${u.n}</b></td>
                    <td class="rank">${formatNumber(u.balance)} ‚Ç¥</td>
                  </tr>`;
        });
        document.getElementById('topTable').innerHTML = h;
    }

    // ============================================
    // –ê–í–¢–û–†–ò–ó–ê–¶–Ü–Ø
    // ============================================
    function authLogin() { 
        const n = document.getElementById('loginName').value.trim(); 
        const p = document.getElementById('loginPass').value; 
        if(!n || !p) return notify("–í–≤–µ–¥—ñ—Ç—å –¥–∞–Ω—ñ", "error"); 
        db.ref('users/'+n).once('value', s => { 
            if(s.exists() && s.val().pass == p) { 
                currentUser=n; localStorage.setItem("royal_online_user",n); startDataSync(); 
            } else { notify("–ù–µ–≤—ñ—Ä–Ω–∏–π –ª–æ–≥—ñ–Ω –∞–±–æ –ø–∞—Ä–æ–ª—å", "error"); } 
        }); 
    }
    
    function authRegister() { 
        const e=document.getElementById('regEmail').value.trim(); 
        const n=document.getElementById('regName').value.trim(); 
        const p=document.getElementById('regPass').value; 
        if(!e||!n||!p) return notify("–ó–∞–ø–æ–≤–Ω—ñ—Ç—å –≤—Å—ñ –ø–æ–ª—è","error"); 
        if(p.length<8||n.includes(' ')||n.includes('.')) return notify("–ü–∞—Ä–æ–ª—å –º—ñ–Ω 8 —Å–∏–º–≤. –ù—ñ–∫ –±–µ–∑ –ø—Ä–æ–±—ñ–ª—ñ–≤!","error"); 
        db.ref('users/'+n).once('value', s => { 
            if(s.exists()){ notify("–¶–µ–π –Ω—ñ–∫–Ω–µ–π–º –≤–∂–µ –∑–∞–π–Ω—è—Ç–∏–π","error"); } 
            else { 
                const id=Math.floor(Math.random()*900000)+100000; 
                db.ref('users/'+n).set({pass:p,email:e,balance:1000,id:id,tag:"–ù–æ–≤–∞—á–æ–∫",dailyStreak:0}).then(() => { 
                    notify("–ê–∫–∞—É–Ω—Ç —Å—Ç–≤–æ—Ä–µ–Ω–æ! –¢–µ–ø–µ—Ä —É–≤—ñ–π–¥—ñ—Ç—å.","success"); toggleAuthMode(false); 
                }); 
            } 
        }); 
    }
    
    function toggleAuthMode(reg) { 
        document.getElementById('loginForm').classList.toggle('hidden', reg); 
        document.getElementById('regForm').classList.toggle('hidden', !reg); 
    }
    
    function logout(){ localStorage.removeItem("royal_online_user"); location.reload(); }

    // ============================================
    // –ê–î–ú–Ü–ù-–ü–ê–ù–ï–õ–¨
    // ============================================
    function loadUserList() { 
        const d=document.getElementById('userList'); 
        d.innerHTML="–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..."; 
        db.ref('users').once('value', s => { 
            d.innerHTML=""; 
            const users=s.val(); 
            if(!users){ d.innerHTML="–ù–µ–º–∞—î –≥—Ä–∞–≤—Ü—ñ–≤"; return; } 
            for(let n in users){ 
                d.innerHTML+=`<div class="admin-user-card" onclick="openAdminManage('${n}')">
                    <div><b>${n}</b><div style="color:#555;font-size:11px;">ID: ${users[n].id||'?'}</div></div>
                    <span style="color:var(--green)">${formatNumber(users[n].balance)} ‚Ç¥</span></div>`; 
            } 
        }); 
    }

    function loadWithdrawRequests() {
        const box = document.getElementById('withdrawRequestsList');
        const content = document.getElementById('withdrawRequestsContent');
        box.classList.remove('hidden');
        content.innerHTML = '–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...';
        
        db.ref('withdraw_requests').orderByChild('status').equalTo('pending').once('value', snap => {
            const data = snap.val();
            if(!data) { content.innerHTML = '<div style="color:#777; padding:10px;">–ù–µ–º–∞ –∑–∞—è–≤–æ–∫</div>'; return; }
            
            content.innerHTML = '';
            Object.entries(data).forEach(([id, req]) => {
                content.innerHTML += `
                    <div class="request-card">
                        <div style="display:flex;justify-content:space-between;margin-bottom:8px;">
                            <b>${req.user}</b><span style="color:var(--green);font-weight:bold;">${req.amount} ‚Ç¥</span>
                        </div>
                        <div style="color:#777;font-size:12px;">${req.method} ‚Ä¢ ${req.card}</div>
                        <div style="color:#555;font-size:11px;">${new Date(req.time).toLocaleString('uk-UA')}</div>
                        <div style="display:flex;gap:8px;margin-top:10px;">
                            <button class="btn-green" style="padding:8px;font-size:12px;" onclick="approveWithdraw('${id}','${req.user}')">‚úÖ –°—Ö–≤–∞–ª–∏—Ç–∏</button>
                            <button class="btn-red" style="padding:8px;font-size:12px;" onclick="rejectWithdraw('${id}','${req.user}',${req.amount})">‚ùå –í—ñ–¥—Ö–∏–ª–∏—Ç–∏</button>
                        </div>
                    </div>
                `;
            });
        });
    }

    function approveWithdraw(id, user) {
        db.ref('withdraw_requests/'+id).update({status:'done'});
        db.ref('users/'+user+'/withdraws/'+id).update({status:'done'});
        db.ref('users/'+user).update({pendingWithdraw: false});
        notify('–í–∏–≤—ñ–¥ —Å—Ö–≤–∞–ª–µ–Ω–æ', 'success');
        loadWithdrawRequests();
    }

    function rejectWithdraw(id, user, amount) {
        // –ü–æ–≤–µ—Ä–Ω—É—Ç–∏ –∫–æ—à—Ç–∏
        db.ref('users/'+user+'/balance').set(firebase.database.ServerValue.increment(amount));
        db.ref('withdraw_requests/'+id).update({status:'rejected'});
        db.ref('users/'+user+'/withdraws/'+id).update({status:'rejected'});
        db.ref('users/'+user).update({pendingWithdraw: false});
        notify('–í–∏–≤—ñ–¥ –≤—ñ–¥—Ö–∏–ª–µ–Ω–æ, –∫–æ—à—Ç–∏ –ø–æ–≤–µ—Ä–Ω—É—Ç–æ', 'success');
        loadWithdrawRequests();
    }
    
    let admSelectedUser = null;
    function openAdminManage(n) { 
        admSelectedUser=n; 
        document.getElementById('admin-user-manage').classList.remove('hidden'); 
        document.getElementById('admManageName').textContent=n; 
    }
    function admGiveMoney() { 
        const a=parseInt(document.getElementById('admAmount').value); 
        if(!a) return; 
        db.ref('users/'+admSelectedUser+'/balance').set(firebase.database.ServerValue.increment(a)); 
        notify("–ë–∞–ª–∞–Ω—Å –∑–º—ñ–Ω–µ–Ω–æ","success"); 
    }
    function admSetTag() { 
        const t=document.getElementById('admTag').value; 
        if(t){ db.ref('users/'+admSelectedUser).update({tag:t}); notify("–°—Ç–∞—Ç—É—Å –∑–º—ñ–Ω–µ–Ω–æ"); } 
    }
    function admBanUser() { 
        if(confirm("–ó–∞–±–ª–æ–∫—É–≤–∞—Ç–∏ –≥—Ä–∞–≤—Ü—è?")){ db.ref('users/'+admSelectedUser).update({banned:true}); notify("–ó–ê–ë–õ–û–ö–û–í–ê–ù–û"); } 
    }
    function admDeleteUser() { 
        if(confirm("–í–ò–î–ê–õ–ò–¢–ò –ê–ö–ê–£–ù–¢ –ù–ê–ó–ê–í–ñ–î–ò?")){ 
            db.ref('users/'+admSelectedUser).remove().then(()=>{ notify("–í–∏–¥–∞–ª–µ–Ω–æ"); closeModal('admin-user-manage'); loadUserList(); }); 
        } 
    }
    function wipeEconomy() { 
        if(prompt("–í–≤–µ–¥—ñ—Ç—å WIPE:")==="WIPE"){ 
            db.ref('users').once('value', s=>{ for(let k in s.val()) db.ref('users/'+k+'/balance').set(1000); notify("–°–∫–∏–Ω—É—Ç–æ","success"); }); 
        } 
    }

    // ============================================
    // –Ü–ù–®–Ü –§–£–ù–ö–¶–Ü–á
    // ============================================
    function switchTab(id, el) { 
        document.querySelectorAll('.screen').forEach(s=>s.classList.add('hidden')); 
        const tab = document.getElementById('tab-'+id);
        if(tab) tab.classList.remove('hidden'); 
        if(el){ document.querySelectorAll('.nav-item').forEach(n=>n.classList.remove('active')); el.classList.add('active'); } 
    }
    
    function openGame(g) { switchTab(g); }
    function openModal(id) { document.getElementById(id).classList.remove('hidden'); }
    function closeModal(id) { document.getElementById(id).classList.add('hidden'); }
    
    function sendMoney() { 
        const t=document.getElementById('transferTo').value; 
        const a=parseInt(document.getElementById('transferAmount').value); 
        if(userData.balance<a||a<=0) return notify("–ù–µ–≤—ñ—Ä–Ω–∞ —Å—É–º–∞","error"); 
        db.ref('users/'+t).once('value', s=>{ 
            if(s.exists()){ 
                db.ref('users/'+currentUser+'/balance').set(userData.balance-a); 
                db.ref('users/'+t+'/balance').set(s.val().balance+a); 
                notify("–ì—Ä–æ—à—ñ –Ω–∞–¥—ñ—Å–ª–∞–Ω–æ!","success"); closeModal('transfer-modal'); 
            } else { notify("–ö–æ—Ä–∏—Å—Ç—É–≤–∞—á–∞ –Ω–µ –∑–Ω–∞–π–¥–µ–Ω–æ","error"); } 
        }); 
    }
    
    function activatePromo() { 
        const c=document.getElementById('promoInput').value.trim(); 
        db.ref('promos/'+c).once('value', s=>{ 
            if(s.exists()){ 
                db.ref('users/'+currentUser+'/balance').set(userData.balance+s.val().value); 
                notify("–ü—Ä–æ–º–æ–∫–æ–¥ –∞–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!","success"); closeModal('promo-modal'); 
            } else { notify("–ù–µ–≤—ñ—Ä–Ω–∏–π –∫–æ–¥","error"); } 
        }); 
    }
    
    function addContact() { 
        const i=document.getElementById('addContactInput').value; 
        db.ref('users/'+i).once('value', s=>{ 
            if(s.exists()){ db.ref('users/'+currentUser+'/contacts/'+i).set({avatar:s.val().avatar||'üë§'}); notify("–î–æ–¥–∞–Ω–æ!"); loadContacts(); } 
            else { notify("–ù–µ –∑–Ω–∞–π–¥–µ–Ω–æ","error"); } 
        }); 
    }
    
    function loadContacts() { 
        const l=document.getElementById('contactsList'); 
        if(!userData.contacts){ l.innerHTML="<div style='color:#777'>–°–ø–∏—Å–æ–∫ –ø–æ—Ä–æ–∂–Ω—ñ–π</div>"; return; } 
        l.innerHTML=""; 
        for(let n in userData.contacts){ 
            l.innerHTML+=`<div class="contact-row"><b>${n}</b> <button class="btn-green" style="width:auto;padding:8px 15px;margin:0;" onclick="quickSend('${n}')">üí∏</button></div>`; 
        } 
    }
    
    function quickSend(n) { document.getElementById('transferTo').value=n; openModal('transfer-modal'); }
    function deleteAccount() { if(confirm("–í–ò–î–ê–õ–ò–¢–ò –ê–ö–ê–£–ù–¢ –ù–ê–ó–ê–í–ñ–î–ò?")) db.ref('users/'+currentUser).remove().then(logout); }
    function updateBio(v) { db.ref('users/'+currentUser).update({tag:v}); notify("–°—Ç–∞—Ç—É—Å –æ–Ω–æ–≤–ª–µ–Ω–æ"); }
    function handleAvatarUpload(i) { 
        if(i.files[0]){ 
            const r=new FileReader(); 
            r.onload=e=>db.ref('users/'+currentUser).update({avatar:e.target.result}); 
            r.readAsDataURL(i.files[0]); notify("–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è..."); 
        } 
    }
    function openHistoryModal() { 
        openModal('history-modal'); 
        const c=document.getElementById('historyList'); c.innerHTML="–ó–∞–≤–∞–Ω—Ç–∞–∂–µ–Ω–Ω—è...";
        db.ref('users/'+currentUser+'/history').limitToLast(20).once('value', s=>{ 
            c.innerHTML=""; 
            if(s.val()) Object.values(s.val()).reverse().forEach(i=>{ c.innerHTML+=`<div style="padding:10px;border-bottom:1px solid #333;color:#ccc;">${i.text}</div>`; }); 
            else c.innerHTML="<div style='padding:10px;color:#777;'>–ü–æ—Ä–æ–∂–Ω—å–æ</div>"; 
        }); 
    }
    function openSupportModal() { 
        openModal('support-modal'); 
        const box=document.getElementById('supportChatBox'); box.innerHTML="";
        db.ref('support_chats/'+currentUser).limitToLast(20).on('child_added', s=>{ 
            const m=s.val(); 
            box.innerHTML+=`<div style="margin-bottom:8px;padding:8px 12px;background:${m.sender==='user'?'#005c4b':'#333'};border-radius:8px;width:fit-content;max-width:80%;margin-left:${m.sender==='user'?'auto':'0'}">${m.text}</div>`; 
            box.scrollTop=box.scrollHeight; 
        }); 
    }
    function sendSupportMsg() { 
        const t=document.getElementById('supportMsg').value; 
        if(t){ db.ref('support_chats/'+currentUser).push({text:t,sender:'user',time:Date.now()}); document.getElementById('supportMsg').value=""; } 
    }
    window.openUserProfile = function(name) { 
        if(name===currentUser) return switchTab('profile'); 
        db.ref('users/'+name).once('value', s=>{ 
            const d=s.val(); 
            if(d){ 
                document.getElementById('viewUserName').textContent=name; 
                document.getElementById('viewUserId').textContent=d.id; 
                document.getElementById('viewUserBal').textContent=formatNumber(d.balance); 
                document.getElementById('viewUserTag').textContent=d.tag||"–ì—Ä–∞–≤–µ—Ü—å"; 
                document.getElementById('viewUserAvatar').innerHTML=(d.avatar&&d.avatar.length>20)?`<img src="${d.avatar}">`:'üë§'; 
                openModal('view-user-modal'); 
            } 
        }); 
    }
  </script>
</body>
</html>