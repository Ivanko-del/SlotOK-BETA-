<!DOCTYPE html>
<html lang="uk">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
  <title>SlotOK MEGA</title>
  
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-app.js"></script>
  <script src="https://www.gstatic.com/firebasejs/8.10.1/firebase-database.js"></script>

  <style>
    :root { --bg: #050505; --text: #fff; --box: #141414; --border: #333; --accent: #d4af37; }
    body { font-family: sans-serif; background: var(--bg); color: var(--text); margin: 0; padding-bottom: 80px; user-select: none; }
    .hidden { display: none !important; }
    .header { padding: 15px; background: #000; border-bottom: 1px solid var(--border); display: flex; justify-content: space-between; align-items: center; position: sticky; top: 0; z-index: 1000; }
    .header-bal { color: #4cd964; font-weight: bold; background: #111; padding: 5px 12px; border-radius: 15px; border: 1px solid #333; }
    .container { padding: 15px; }
    .box { background: var(--box); border-radius: 12px; padding: 15px; border: 1px solid var(--border); margin-bottom: 15px; }
    
    button { padding: 14px; width: 100%; border: none; border-radius: 10px; font-weight: bold; cursor: pointer; margin-bottom: 8px; font-size: 15px; }
    .btn-gold { background: linear-gradient(45deg, var(--accent), #ffdb4d); color: #000; }
    .btn-outline { background: transparent; border: 1px solid #555; color: #ccc; }
    .btn-red { background: #ff3b30; color: #fff; }
    .btn-green { background: #4cd964; color: #000; }

    input { width: 100%; padding: 14px; margin-bottom: 10px; background: #1a1a1a; border: 1px solid #333; color: #fff; border-radius: 10px; box-sizing: border-box; text-align: center; font-size: 16px; }

    /* –ì–†–ò */
    .game-card { background: var(--box); border: 1px solid var(--border); border-radius: 12px; padding: 15px; margin-bottom: 10px; display: flex; align-items: center; gap: 15px; }
    .tower-grid { display: grid; grid-template-rows: repeat(10, 1fr); gap: 5px; margin-bottom: 15px; }
    .tower-row { display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 5px; opacity: 0.3; pointer-events: none; }
    .tower-row.active { opacity: 1; pointer-events: auto; }
    .tower-cell { background: #222; height: 40px; border-radius: 5px; display: flex; align-items: center; justify-content: center; border: 1px solid #444; font-size: 20px; }
    
    .mines-grid { display: grid; grid-template-columns: repeat(5, 1fr); gap: 5px; margin-bottom: 10px; }
    .mine-cell { aspect-ratio: 1; background: #222; border-radius: 5px; display: flex; align-items: center; justify-content: center; font-size: 20px; border: 1px solid #333; }

    /* –ß–ê–¢ */
    #chatBox { height: 300px; overflow-y: auto; background: #080808; border-radius: 10px; padding: 10px; border: 1px solid #222; margin-bottom: 10px; }
    .msg { margin-bottom: 10px; font-size: 14px; border-bottom: 1px solid #111; padding-bottom: 5px; }
    .msg-u { color: var(--accent); font-weight: bold; }

    /* –ù–ê–í–Ü–ì–ê–¶–Ü–Ø */
    .nav { position: fixed; bottom: 0; width: 100%; height: 65px; background: #000; border-top: 1px solid #222; display: flex; justify-content: space-around; align-items: center; }
    .nav-item { color: #555; text-align: center; font-size: 10px; }
    .nav-item.active { color: var(--accent); }

    #loading { position: fixed; inset: 0; background: #000; z-index: 9999; display: flex; justify-content: center; align-items: center; color: var(--accent); font-weight: bold; font-size: 20px; }
  </style>
</head>
<body>

<div id="loading">–ó–ê–í–ê–ù–¢–ê–ñ–ï–ù–ù–Ø...</div>

<div class="header">
  <h2 style="margin:0; font-style:italic;">SLOTOK <span style="color:var(--accent)">PRO</span></h2>
  <div class="header-bal"><span id="topBal">0</span> ‚Ç¥</div>
</div>

<div class="container">
  
  <div id="tab-home" class="screen">
    <div class="box" style="text-align:center;">
      <div style="font-size:12px; color:#777;">–í–ê–® –°–¢–ê–¢–£–°</div>
      <div id="uStatus" style="font-weight:bold; color:var(--accent); font-size:18px;">–ù–û–í–ê–ß–û–ö</div>
    </div>
    <div class="game-card" onclick="go('dice')"><span>üé≤</span> <b>Dice (–ö–æ—Å—Ç—ñ)</b></div>
    <div class="game-card" onclick="go('tower')"><span>üè∞</span> <b>Tower (–í–µ–∂–∞)</b></div>
    <div class="game-card" onclick="go('double')"><span>üî¥</span> <b>Double (–°–ø—ñ–ª—å–Ω–∞)</b></div>
    <div class="game-card" onclick="go('mines')"><span>üí£</span> <b>Mines (–°–∞–ø–µ—Ä)</b></div>
    <div class="game-card" onclick="go('slots')"><span>üé∞</span> <b>Slots (–°–ª–æ—Ç–∏)</b></div>
  </div>

  <div id="tab-dice" class="screen hidden">
    <button class="btn-outline" onclick="go('home')">‚¨Ö –ù–∞–∑–∞–¥</button>
    <div class="box" style="text-align:center;">
      <div id="diceRes" style="font-size:45px; margin:10px 0; font-weight:bold; color:var(--accent);">0.00</div>
      <p>–®–∞–Ω—Å –≤–∏–≥—Ä–∞—à—É: <span id="diceChanceVal">50</span>%</p>
      <input type="range" id="diceRange" min="1" max="95" value="50" oninput="document.getElementById('diceChanceVal').innerText=this.value">
      <input id="betDice" type="number" value="100">
      <button class="btn-gold" onclick="playDice()">–ì–†–ê–¢–ò</button>
    </div>
  </div>

  <div id="tab-tower" class="screen hidden">
    <button class="btn-outline" onclick="go('home')">‚¨Ö –ù–∞–∑–∞–¥</button>
    <div class="tower-grid" id="towerGrid"></div>
    <div class="box">
      <input id="betTower" type="number" value="100">
      <button class="btn-gold" id="towerStart" onclick="startTower()">–°–¢–ê–†–¢</button>
      <button class="btn-green hidden" id="towerCash" onclick="cashTower()">–ó–ê–ë–†–ê–¢–ò</button>
    </div>
  </div>

  <div id="tab-double" class="screen hidden">
    <button class="btn-outline" onclick="go('home')">‚¨Ö –ù–∞–∑–∞–¥</button>
    <div class="box" style="text-align:center;">
      <div id="dTimer" style="font-size:20px; color:var(--accent); margin-bottom:10px;">–ß–µ–∫–∞—î–º–æ...</div>
      <div id="dHist" style="display:flex; gap:5px; justify-content:center; margin-bottom:15px;"></div>
      <div style="display:flex; gap:5px; margin-bottom:10px;">
        <button class="btn-red" style="margin:0;" onclick="setDBet('red')">x2</button>
        <button class="btn-green" style="margin:0;" onclick="setDBet('green')">x14</button>
        <button class="btn-outline" style="margin:0; background:#222;" onclick="setDBet('black')">x2</button>
      </div>
      <input id="betDouble" type="number" value="100">
      <div id="dMyBet" style="font-size:12px; color:#777;"></div>
    </div>
  </div>

  <div id="tab-mines" class="screen hidden">
    <button class="btn-outline" onclick="go('home')">‚¨Ö –ù–∞–∑–∞–¥</button>
    <div class="mines-grid" id="mGrid"></div>
    <div class="box">
      <input id="betMines" type="number" value="100">
      <button class="btn-gold" id="mStart" onclick="startMines()">–°–¢–ê–†–¢</button>
      <button class="btn-green hidden" id="mCash" onclick="cashMines()">–ó–ê–ë–†–ê–¢–ò</button>
    </div>
  </div>

  <div id="tab-slots" class="screen hidden">
    <button class="btn-outline" onclick="go('home')">‚¨Ö –ù–∞–∑–∞–¥</button>
    <div class="box" style="display:flex; justify-content:center; gap:15px; font-size:50px; padding:30px 0;">
      <span id="s1">‚ùì</span><span id="s2">‚ùì</span><span id="s3">‚ùì</span>
    </div>
    <input id="betSlots" type="number" value="100">
    <button class="btn-gold" onclick="playSlots()">–ö–†–£–¢–ò–¢–ò</button>
  </div>

  <div id="tab-chat" class="screen hidden">
    <div id="chatBox"></div>
    <div style="display:flex; gap:5px;">
      <input id="chatIn" placeholder="–ü–æ–≤—ñ–¥–æ–º–ª–µ–Ω–Ω—è..." style="margin:0;">
      <button class="btn-gold" style="width:70px; margin:0;" onclick="sendChat()">‚û§</button>
    </div>
  </div>

  <div id="tab-profile" class="screen hidden">
    <div class="box" style="text-align:center;">
      <h2 id="pName">...</h2>
      <p id="pId" style="color:#777;"></p>
      <button class="btn-outline" onclick="openPromo()">üéÅ –ü—Ä–æ–º–æ–∫–æ–¥</button>
      <button class="btn-red" onclick="logout()">–í–ò–ô–¢–ò</button>
    </div>
    <div id="admBox" class="box hidden" style="border-color:red;">
      <h3 style="margin-top:0;">–ê–¥–º—ñ–Ω –ü–∞–Ω–µ–ª—å</h3>
      <input id="apName" placeholder="–ù–∞–∑–≤–∞ –ø—Ä–æ–º–æ">
      <input id="apSum" type="number" placeholder="–°—É–º–∞">
      <input id="apLimit" type="number" placeholder="–õ—ñ–º—ñ—Ç">
      <button class="btn-green" onclick="addPromo()">–°—Ç–≤–æ—Ä–∏—Ç–∏ –ü—Ä–æ–º–æ</button>
    </div>
  </div>

  <div id="tab-top" class="screen hidden">
    <div class="box">
      <h3>–¢–û–ü –ì–†–ê–í–¶–Ü–í</h3>
      <div id="topList"></div>
    </div>
  </div>

</div>

<div id="auth" class="hidden" style="position:fixed; inset:0; background:#000; z-index:5000; padding:30px;">
  <h1 style="text-align:center; color:var(--accent); margin-bottom:40px;">SLOTOK</h1>
  <input id="uName" placeholder="–ù—ñ–∫–Ω–µ–π–º">
  <input id="uPass" type="password" placeholder="–ü–∞—Ä–æ–ª—å">
  <button class="btn-gold" onclick="auth('login')">–£–í–Ü–ô–¢–ò</button>
  <button class="btn-outline" onclick="auth('reg')">–†–ï–Ñ–°–¢–†–ê–¶–Ü–Ø</button>
</div>

<div id="promo-m" class="hidden" style="position:fixed; inset:0; background:rgba(0,0,0,0.9); z-index:6000; padding:40px 20px;">
  <div class="box">
    <h3>–í–≤–µ–¥—ñ—Ç—å –ü—Ä–æ–º–æ–∫–æ–¥</h3>
    <input id="promoIn" placeholder="–ö–û–î">
    <button class="btn-gold" onclick="usePromo()">–ê–ö–¢–ò–í–£–í–ê–¢–ò</button>
    <button class="btn-outline" onclick="document.getElementById('promo-m').classList.add('hidden')">–ó–ê–ö–†–ò–¢–ò</button>
  </div>
</div>

<nav class="nav">
  <div class="nav-item active" onclick="go('home', this)">üè†<br>–ì–æ–ª–æ–≤–Ω–∞</div>
  <div class="nav-item" onclick="go('chat', this)">üí¨<br>–ß–∞—Ç</div>
  <div class="nav-item" onclick="go('top', this)">üèÜ<br>–¢–æ–ø</div>
  <div class="nav-item" onclick="go('profile', this)">üë§<br>–ü—Ä–æ—Ñ—ñ–ª—å</div>
</nav>

<script>
  // –Ü–Ω—ñ—Ü—ñ–∞–ª—ñ–∑–∞—Ü—ñ—è Firebase
  const cfg = { apiKey: "AIzaSyB0gJDyr8z2SWPV3Tf73ZRNNPuglxHTCZw", authDomain: "slotok-web-server.firebaseapp.com", databaseURL: "https://slotok-web-server-default-rtdb.firebaseio.com", projectId: "slotok-web-server", storageBucket: "slotok-web-server.firebasestorage.app", appId: "1:1086314476940:web:d3629d2d0fe16f7c1f12a9" };
  firebase.initializeApp(cfg);
  const db = firebase.database();

  let user = localStorage.getItem("slotok_v2_user");
  let uData = null;

  window.onload = () => {
    document.getElementById('loading').classList.add('hidden');
    if(!user) document.getElementById('auth').classList.remove('hidden');
    else init();
  };

  function init() {
    db.ref('users/'+user).on('value', s => {
      uData = s.val();
      if(!uData) return logout();
      document.getElementById('topBal').innerText = Math.floor(uData.balance);
      document.getElementById('pName').innerText = user;
      document.getElementById('pId').innerText = "ID: " + uData.id;
      document.getElementById('auth').classList.add('hidden');
      
      let lvl = "–ù–û–í–ê–ß–û–ö";
      if(uData.balance > 1000000) lvl = "–ú–ê–ì–ù–ê–¢";
      else if(uData.balance > 100000) lvl = "VIP";
      document.getElementById('uStatus').innerText = lvl;
      
      if(user.toLowerCase() === 'theivankoo' || uData.isAdmin) {
          document.getElementById('admBox').classList.remove('hidden');
      }
    });
    loadChat();
    loadTop();
    startDoubleLoop();
  }

  // --- –Ü–ì–†–û–í–ê –õ–û–ì–Ü–ö–ê ---
  function playDice() {
    let b = vB('betDice'); if(!b) return;
    let ch = parseInt(document.getElementById('diceRange').value);
    let r = (Math.random()*100).toFixed(2);
    document.getElementById('diceRes').innerText = r;
    if(parseFloat(r) <= ch) {
      let win = b * (100/ch) * 0.95;
      db.ref('users/'+user+'/balance').set(uData.balance + win);
      msg("+"+Math.floor(win), "green");
    } else {
      db.ref('users/'+user+'/balance').set(uData.balance - b);
      msg("–ü—Ä–æ–≥—Ä–∞—à", "red");
    }
  }

  let tR = 0; let tP = 0; let tB = 0;
  function startTower() {
    tB = vB('betTower'); if(!tB) return;
    db.ref('users/'+user+'/balance').set(uData.balance - tB);
    tR = 0; tP = tB;
    document.getElementById('towerStart').classList.add('hidden');
    document.getElementById('towerCash').classList.remove('hidden');
    document.getElementById('towerCash').innerText = "–ó–ê–ë–†–ê–¢–ò " + tB;
    drawTower();
  }
  function drawTower() {
    let g = document.getElementById('towerGrid'); g.innerHTML = "";
    for(let i=9; i>=0; i--) {
      let r = document.createElement('div'); r.className = "tower-row" + (i===tR?" active":"");
      for(let j=0; j<3; j++) {
        let c = document.createElement('div'); c.className = "tower-cell"; c.innerText = "üì¶";
        c.onclick = () => {
          if(Math.random() > 0.35) {
            tR++; tP *= 1.45;
            document.getElementById('towerCash').innerText = "–ó–ê–ë–†–ê–¢–ò " + Math.floor(tP);
            if(tR > 9) cashTower(); else drawTower();
          } else {
            msg("–ë–û–ú–ë–ê!", "red"); stopTower();
          }
        };
        r.appendChild(c);
      }
      g.appendChild(r);
    }
  }
  function cashTower() { db.ref('users/'+user+'/balance').set(uData.balance + tP); msg("+"+Math.floor(tP), "green"); stopTower(); }
  function stopTower() { document.getElementById('towerStart').classList.remove('hidden'); document.getElementById('towerCash').classList.add('hidden'); document.getElementById('towerGrid').innerHTML = ""; }

  let dBet = null;
  function setDBet(t) {
    let b = vB('betDouble'); if(!b) return;
    dBet = {t, b};
    document.getElementById('dMyBet').innerText = "–°—Ç–∞–≤–∫–∞: " + b + " –Ω–∞ " + t;
  }
  function startDoubleLoop() {
    setInterval(() => {
      let s = 15 - (Math.floor(Date.now()/1000) % 15);
      document.getElementById('dTimer').innerText = "–î–æ —Ä–æ–∑—ñ–≥—Ä–∞—à—É: " + s + "—Å";
      if(s === 1) {
        let cols = ['red','black','red','black','red','black','green'];
        let res = cols[Math.floor(Math.random()*cols.length)];
        setTimeout(() => {
          if(dBet) {
            if(dBet.t === res) {
              let m = res==='green'?14:2;
              db.ref('users/'+user+'/balance').set(uData.balance + (dBet.b * m));
              msg("DOUBLE WIN!", "green");
            } else {
              db.ref('users/'+user+'/balance').set(uData.balance - dBet.b);
            }
          }
          dBet = null; document.getElementById('dMyBet').innerText = "";
          let dot = `<div style="width:15px; height:15px; border-radius:50%; background:${res==='green'?'#4cd964':(res==='red'?'#ff3b30':'#555')}"></div>`;
          document.getElementById('dHist').innerHTML = dot + document.getElementById('dHist').innerHTML;
        }, 1000);
      }
    }, 1000);
  }

  let mB = 0; let mG = []; let mP = 0; let mAct = false;
  function startMines() {
    mB = vB('betMines'); if(!mB) return;
    db.ref('users/'+user+'/balance').set(uData.balance - mB);
    mAct = true; mP = mB; mG = new Array(25).fill(0);
    let bCount = 0; while(bCount < 3) { let idx = Math.floor(Math.random()*25); if(mG[idx]===0){mG[idx]=1; bCount++;} }
    document.getElementById('mStart').classList.add('hidden');
    document.getElementById('mCash').classList.remove('hidden');
    let g = document.getElementById('mGrid'); g.innerHTML = "";
    for(let i=0; i<25; i++) {
      let c = document.createElement('div'); c.className = "mine-cell"; c.innerText = "‚ùì";
      c.onclick = () => {
        if(!mAct || c.innerText !== "‚ùì") return;
        if(mG[i] === 1) { c.innerText = "üí£"; mAct = false; msg("–ë–£–ú!", "red"); setTimeout(startMines, 1000); stopMines(); }
        else { c.innerText = "üíé"; mP *= 1.2; document.getElementById('mCash').innerText = "–ó–ê–ë–†–ê–¢–ò " + Math.floor(mP); }
      };
      g.appendChild(c);
    }
  }
  function cashMines() { db.ref('users/'+user+'/balance').set(uData.balance + mP); msg("+"+Math.floor(mP), "green"); stopMines(); }
  function stopMines() { mAct = false; document.getElementById('mStart').classList.remove('hidden'); document.getElementById('mCash').classList.add('hidden'); document.getElementById('mGrid').innerHTML = ""; }

  function playSlots() {
    let b = vB('betSlots'); if(!b) return;
    let s = ["üçé","üçã","üíé","7Ô∏è‚É£"];
    let r1=s[Math.floor(Math.random()*4)], r2=s[Math.floor(Math.random()*4)], r3=s[Math.floor(Math.random()*4)];
    document.getElementById('s1').innerText=r1; document.getElementById('s2').innerText=r2; document.getElementById('s3').innerText=r3;
    if(r1===r2 && r2===r3) {
      let m = r1==="7Ô∏è‚É£"?50:10;
      db.ref('users/'+user+'/balance').set(uData.balance + (b*m)); msg("SLOTS WIN!", "green");
    } else db.ref('users/'+user+'/balance').set(uData.balance - b);
  }

  // --- –°–ò–°–¢–ï–ú–ê ---
  function go(t, el) {
    document.querySelectorAll('.screen').forEach(s => s.classList.add('hidden'));
    document.getElementById('tab-'+t).classList.remove('hidden');
    if(el) { document.querySelectorAll('.nav-item').forEach(n => n.classList.remove('active')); el.classList.add('active'); }
  }
  function vB(id) {
    let v = parseInt(document.getElementById(id).value);
    if(isNaN(v) || v <= 0 || v > uData.balance) { msg("–ü–æ–º–∏–ª–∫–∞ —Å—Ç–∞–≤–∫–∏", "red"); return 0; }
    return v;
  }
  function msg(t, c) {
    let d = document.createElement('div');
    d.style = `position:fixed; top:20px; left:50%; transform:translateX(-50%); background:${c==='green'?'#4cd964':'#ff3b30'}; color:#000; padding:10px 20px; border-radius:10px; z-index:10000; font-weight:bold;`;
    d.innerText = t; document.body.appendChild(d); setTimeout(()=>d.remove(), 2000);
  }
  function auth(t) {
    let n = document.getElementById('uName').value.trim();
    let p = document.getElementById('uPass').value;
    if(n.length < 3) return msg("–ö–æ—Ä–æ—Ç–∫–∏–π –Ω—ñ–∫", "red");
    db.ref('users/'+n).once('value', s => {
      if(t === 'login') {
        if(s.exists() && s.val().pass === p) { user = n; localStorage.setItem("slotok_v2_user", n); init(); }
        else msg("–ù–µ–≤—ñ—Ä–Ω–æ", "red");
      } else {
        if(s.exists()) msg("–ó–∞–π–Ω—è—Ç–æ", "red");
        else { db.ref('users/'+n).set({pass:p, balance:1000, id:Math.floor(Math.random()*90000)}); user = n; localStorage.setItem("slotok_v2_user", n); init(); }
      }
    });
  }
  function logout() { localStorage.removeItem("slotok_v2_user"); location.reload(); }

  function sendChat() {
    let m = document.getElementById('chatIn').value; if(!m) return;
    db.ref('chat').push({u: user, m: m}); document.getElementById('chatIn').value = "";
  }
  function loadChat() {
    db.ref('chat').limitToLast(20).on('value', s => {
      let b = document.getElementById('chatBox'); b.innerHTML = "";
      s.forEach(c => { b.innerHTML += `<div class="msg"><span class="msg-u">${c.val().u}:</span> ${c.val().m}</div>`; });
      b.scrollTop = b.scrollHeight;
    });
  }
  function loadTop() {
    db.ref('users').orderByChild('balance').limitToLast(10).on('value', s => {
      let l = document.getElementById('topList'); l.innerHTML = "";
      let arr = []; s.forEach(c => { arr.push({n:c.key, b:c.val().balance}); });
      arr.reverse().forEach((u, i) => { l.innerHTML += `<div style="padding:10px; border-bottom:1px solid #222;">${i+1}. ${u.n} - ${Math.floor(u.b)} ‚Ç¥</div>`; });
    });
  }

  function addPromo() {
    let n = document.getElementById('apName').value;
    let s = parseInt(document.getElementById('apSum').value);
    let l = parseInt(document.getElementById('apLimit').value);
    db.ref('promos/'+n).set({s, l}); msg("–ü—Ä–æ–º–æ —Å—Ç–≤–æ—Ä–µ–Ω–æ", "green");
  }
  function openPromo() { document.getElementById('promo-m').classList.remove('hidden'); }
  function usePromo() {
    let c = document.getElementById('promoIn').value;
    db.ref('promos/'+c).once('value', s => {
      let p = s.val();
      if(p && p.l > 0 && (!p.u || !p.u[user])) {
        db.ref('users/'+user+'/balance').set(uData.balance + p.s);
        db.ref('promos/'+c+'/l').set(p.l - 1);
        db.ref('promos/'+c+'/u/'+user).set(true);
        msg("–ê–∫—Ç–∏–≤–æ–≤–∞–Ω–æ!", "green");
        document.getElementById('promo-m').classList.add('hidden');
      } else msg("–ü–æ–º–∏–ª–∫–∞ –∫–æ–¥—É", "red");
    });
  }
</script>

</body>
</html>